<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>The Analysis of South African Household Survey Data using R</title>
  <meta name="description" content="The Analysis of South African Household Survey Data using R">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="The Analysis of South African Household Survey Data using R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="The Analysis of South African Household Survey Data using R" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="The Analysis of South African Household Survey Data using R" />
  
  <meta name="twitter:description" content="The Analysis of South African Household Survey Data using R" />
  

<meta name="author" content="Takwanisa Machemedze">


<meta name="date" content="2018-08-21">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="measures-of-central-tendency-and-variability.html">
<link rel="next" href="simple-regression-analysis.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-is-r"><i class="fa fa-check"></i><b>1.1</b> What is R?</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#pros-and-cons-of-r"><i class="fa fa-check"></i><b>1.2</b> Pros and cons of R</a><ul>
<li class="chapter" data-level="1.2.1" data-path="introduction.html"><a href="introduction.html#pros"><i class="fa fa-check"></i><b>1.2.1</b> Pros</a></li>
<li class="chapter" data-level="1.2.2" data-path="introduction.html"><a href="introduction.html#cons"><i class="fa fa-check"></i><b>1.2.2</b> Cons</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-is-rstudio"><i class="fa fa-check"></i><b>1.3</b> What is RStudio?</a></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#the-r-system"><i class="fa fa-check"></i><b>1.4</b> The R system</a><ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#base-system"><i class="fa fa-check"></i><b>1.4.1</b> Base system</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html"><i class="fa fa-check"></i><b>2</b> Getting started with R</a><ul>
<li class="chapter" data-level="2.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#introduction-1"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#organize-your-r-session"><i class="fa fa-check"></i><b>2.2</b> Organize your R session</a><ul>
<li class="chapter" data-level="2.2.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#working-directory"><i class="fa fa-check"></i><b>2.2.1</b> Working directory</a></li>
<li class="chapter" data-level="2.2.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#load-and-install-required-libraries"><i class="fa fa-check"></i><b>2.2.2</b> Load (and install) required libraries</a></li>
<li class="chapter" data-level="2.2.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#comments"><i class="fa fa-check"></i><b>2.2.3</b> Comments</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#getting-help"><i class="fa fa-check"></i><b>2.3</b> Getting help</a></li>
<li class="chapter" data-level="2.4" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#output-file"><i class="fa fa-check"></i><b>2.4</b> Output file</a></li>
<li class="chapter" data-level="2.5" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#objects-in-r"><i class="fa fa-check"></i><b>2.5</b> Objects in R</a><ul>
<li class="chapter" data-level="2.5.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#removing-objects-from-the-r-environment---rm-function"><i class="fa fa-check"></i><b>2.5.1</b> Removing objects from the R environment - rm() function</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#saving-in-r"><i class="fa fa-check"></i><b>2.6</b> Saving in R</a></li>
<li class="chapter" data-level="2.7" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#importing-nids-data-into-r"><i class="fa fa-check"></i><b>2.7</b> Importing NIDS data into R</a></li>
<li class="chapter" data-level="2.8" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#exploring-the-data"><i class="fa fa-check"></i><b>2.8</b> Exploring the data</a><ul>
<li class="chapter" data-level="2.8.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#subsetting-data---part-1"><i class="fa fa-check"></i><b>2.8.1</b> Subsetting data - part 1</a></li>
<li class="chapter" data-level="2.8.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#data-documentation---value-and-variable-labels"><i class="fa fa-check"></i><b>2.8.2</b> Data documentation - value and variable labels</a></li>
<li class="chapter" data-level="2.8.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#operators-in-r"><i class="fa fa-check"></i><b>2.8.3</b> Operators in R</a></li>
<li class="chapter" data-level="2.8.4" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#subsetting-data---part-2"><i class="fa fa-check"></i><b>2.8.4</b> Subsetting data - part 2</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#tidyverse"><i class="fa fa-check"></i><b>2.9</b> Tidyverse</a><ul>
<li class="chapter" data-level="2.9.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#brief-introduction-to-tidyverse"><i class="fa fa-check"></i><b>2.9.1</b> Brief introduction to tidyverse</a></li>
<li class="chapter" data-level="2.9.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#core-tidyverse-packages"><i class="fa fa-check"></i><b>2.9.2</b> Core tidyverse packages</a></li>
<li class="chapter" data-level="2.9.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#install-and-load-tidyverse-packages"><i class="fa fa-check"></i><b>2.9.3</b> Install and load tidyverse packages</a></li>
<li class="chapter" data-level="2.9.4" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#dplyr-verbs"><i class="fa fa-check"></i><b>2.9.4</b> dplyr verbs</a></li>
<li class="chapter" data-level="2.9.5" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#using-dplyr-functions"><i class="fa fa-check"></i><b>2.9.5</b> Using dplyr functions</a></li>
<li class="chapter" data-level="2.9.6" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#pipe-operator"><i class="fa fa-check"></i><b>2.9.6</b> Pipe operator %&gt;%</a></li>
</ul></li>
<li class="chapter" data-level="2.10" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#more-data-exploration"><i class="fa fa-check"></i><b>2.10</b> More data exploration</a><ul>
<li class="chapter" data-level="2.10.1" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#example-1-subset-variables"><i class="fa fa-check"></i><b>2.10.1</b> Example 1: Subset variables</a></li>
<li class="chapter" data-level="2.10.2" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#example-2-subset-observations"><i class="fa fa-check"></i><b>2.10.2</b> Example 2: Subset observations</a></li>
<li class="chapter" data-level="2.10.3" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#example-3-subset-both-observations-and-variables"><i class="fa fa-check"></i><b>2.10.3</b> Example 3: Subset both observations and variables</a></li>
</ul></li>
<li class="chapter" data-level="2.11" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#managing-the-data"><i class="fa fa-check"></i><b>2.11</b> Managing the data</a></li>
<li class="chapter" data-level="2.12" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#worked-example-creating-a-bmi-variable"><i class="fa fa-check"></i><b>2.12</b> Worked example: creating a bmi variable</a></li>
<li class="chapter" data-level="2.13" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#question-answers"><i class="fa fa-check"></i><b>2.13</b> Question answers</a></li>
<li class="chapter" data-level="2.14" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#exercises"><i class="fa fa-check"></i><b>2.14</b> Exercises</a></li>
<li class="chapter" data-level="2.15" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#exercise-answers"><i class="fa fa-check"></i><b>2.15</b> Exercise answers</a></li>
<li class="chapter" data-level="2.16" data-path="getting-started-with-r.html"><a href="getting-started-with-r.html#session-information"><i class="fa fa-check"></i><b>2.16</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="understanding-distributions.html"><a href="understanding-distributions.html"><i class="fa fa-check"></i><b>3</b> Understanding distributions</a><ul>
<li class="chapter" data-level="3.1" data-path="understanding-distributions.html"><a href="understanding-distributions.html#introduction-2"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="understanding-distributions.html"><a href="understanding-distributions.html#variable-types"><i class="fa fa-check"></i><b>3.2</b> Variable types</a></li>
<li class="chapter" data-level="3.3" data-path="understanding-distributions.html"><a href="understanding-distributions.html#count-observations---dimnrow"><i class="fa fa-check"></i><b>3.3</b> Count observations - dim(),nrow()</a></li>
<li class="chapter" data-level="3.4" data-path="understanding-distributions.html"><a href="understanding-distributions.html#using-household-level-variables"><i class="fa fa-check"></i><b>3.4</b> Using household level variables</a></li>
<li class="chapter" data-level="3.5" data-path="understanding-distributions.html"><a href="understanding-distributions.html#frequency-distribution-tables"><i class="fa fa-check"></i><b>3.5</b> Frequency distribution tables</a></li>
<li class="chapter" data-level="3.6" data-path="understanding-distributions.html"><a href="understanding-distributions.html#frequency-distribution-tables-household-level-data"><i class="fa fa-check"></i><b>3.6</b> Frequency distribution tables: household level data</a></li>
<li class="chapter" data-level="3.7" data-path="understanding-distributions.html"><a href="understanding-distributions.html#missing-data-and-non-responses"><i class="fa fa-check"></i><b>3.7</b> Missing data and non-responses</a></li>
<li class="chapter" data-level="3.8" data-path="understanding-distributions.html"><a href="understanding-distributions.html#three-primary-origins-of-na-missing-data-in-nids"><i class="fa fa-check"></i><b>3.8</b> Three primary origins of NA-missing data in NIDS</a></li>
<li class="chapter" data-level="3.9" data-path="understanding-distributions.html"><a href="understanding-distributions.html#missing-data-and-qualifiers"><i class="fa fa-check"></i><b>3.9</b> Missing data and qualifiers</a></li>
<li class="chapter" data-level="3.10" data-path="understanding-distributions.html"><a href="understanding-distributions.html#question-answers-1"><i class="fa fa-check"></i><b>3.10</b> Question answers</a></li>
<li class="chapter" data-level="3.11" data-path="understanding-distributions.html"><a href="understanding-distributions.html#exercises-1"><i class="fa fa-check"></i><b>3.11</b> Exercises</a></li>
<li class="chapter" data-level="3.12" data-path="understanding-distributions.html"><a href="understanding-distributions.html#session-information-1"><i class="fa fa-check"></i><b>3.12</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="understanding-graphs.html"><a href="understanding-graphs.html"><i class="fa fa-check"></i><b>4</b> Understanding graphs</a><ul>
<li class="chapter" data-level="4.1" data-path="understanding-graphs.html"><a href="understanding-graphs.html#introduction-3"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="understanding-graphs.html"><a href="understanding-graphs.html#getting-ready"><i class="fa fa-check"></i><b>4.2</b> Getting ready</a></li>
<li class="chapter" data-level="4.3" data-path="understanding-graphs.html"><a href="understanding-graphs.html#ggplot2-and-its-elements"><i class="fa fa-check"></i><b>4.3</b> ggplot2 and its elements</a></li>
<li class="chapter" data-level="4.4" data-path="understanding-graphs.html"><a href="understanding-graphs.html#histograms"><i class="fa fa-check"></i><b>4.4</b> Histograms</a><ul>
<li class="chapter" data-level="4.4.1" data-path="understanding-graphs.html"><a href="understanding-graphs.html#graphing-economic-wellbeing-in-south-africa-in-2008"><i class="fa fa-check"></i><b>4.4.1</b> Graphing economic wellbeing in South Africa in 2008</a></li>
<li class="chapter" data-level="4.4.2" data-path="understanding-graphs.html"><a href="understanding-graphs.html#facetting"><i class="fa fa-check"></i><b>4.4.2</b> Facetting</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="understanding-graphs.html"><a href="understanding-graphs.html#worked-example-1-what-is-the-most-common-age-at-which-people-start-smoking"><i class="fa fa-check"></i><b>4.5</b> Worked example 1: What is the most common age at which people start smoking?</a></li>
<li class="chapter" data-level="4.6" data-path="understanding-graphs.html"><a href="understanding-graphs.html#pie-charts"><i class="fa fa-check"></i><b>4.6</b> Pie charts</a></li>
<li class="chapter" data-level="4.7" data-path="understanding-graphs.html"><a href="understanding-graphs.html#investigating-newborn-and-infant-gender"><i class="fa fa-check"></i><b>4.7</b> Investigating newborn and infant gender</a><ul>
<li class="chapter" data-level="4.7.1" data-path="understanding-graphs.html"><a href="understanding-graphs.html#exploring-the-distribution-of-race-across-provinces"><i class="fa fa-check"></i><b>4.7.1</b> Exploring the distribution of race across provinces</a></li>
<li class="chapter" data-level="4.7.2" data-path="understanding-graphs.html"><a href="understanding-graphs.html#urban-vs.rural-where-are-south-africans-living"><i class="fa fa-check"></i><b>4.7.2</b> Urban vs. rural, where are South Africans living?</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="understanding-graphs.html"><a href="understanding-graphs.html#worked-example-2-are-there-differences-between-the-age-at-which-men-and-women-start-smoking"><i class="fa fa-check"></i><b>4.8</b> Worked example 2: Are there differences between the age at which men and women start smoking?</a><ul>
<li class="chapter" data-level="4.8.1" data-path="understanding-graphs.html"><a href="understanding-graphs.html#exercise"><i class="fa fa-check"></i><b>4.8.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="understanding-graphs.html"><a href="understanding-graphs.html#bar-graphs"><i class="fa fa-check"></i><b>4.9</b> Bar graphs</a><ul>
<li class="chapter" data-level="4.9.1" data-path="understanding-graphs.html"><a href="understanding-graphs.html#investigating-satisfaction-levels-in-south-africans"><i class="fa fa-check"></i><b>4.9.1</b> Investigating Satisfaction levels in South Africans</a></li>
<li class="chapter" data-level="4.9.2" data-path="understanding-graphs.html"><a href="understanding-graphs.html#worked-example-3-does-the-frequency-of-alcohol-consumption-vary-by-gender-race-or-religion"><i class="fa fa-check"></i><b>4.9.2</b> Worked example 3: Does the frequency of alcohol consumption vary by gender, race or religion?</a></li>
</ul></li>
<li class="chapter" data-level="4.10" data-path="understanding-graphs.html"><a href="understanding-graphs.html#question-answers-2"><i class="fa fa-check"></i><b>4.10</b> Question answers</a></li>
<li class="chapter" data-level="4.11" data-path="understanding-graphs.html"><a href="understanding-graphs.html#session-information-2"><i class="fa fa-check"></i><b>4.11</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html"><i class="fa fa-check"></i><b>5</b> Measures of central tendency and variability</a><ul>
<li class="chapter" data-level="5.1" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#getting-ready-1"><i class="fa fa-check"></i><b>5.1</b> Getting ready</a></li>
<li class="chapter" data-level="5.2" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#introduction-4"><i class="fa fa-check"></i><b>5.2</b> Introduction</a></li>
<li class="chapter" data-level="5.3" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#understanding-distributions-of-continuous-variables"><i class="fa fa-check"></i><b>5.3</b> Understanding distributions of continuous variables</a></li>
<li class="chapter" data-level="5.4" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#continuous-variables-and-recoding"><i class="fa fa-check"></i><b>5.4</b> Continuous variables and recoding</a></li>
<li class="chapter" data-level="5.5" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#summarise-by---summary-base-r-and-group_by---summarise-dplyr"><i class="fa fa-check"></i><b>5.5</b> Summarise: by - summary (base R) and group_by - summarise (dplyr)</a></li>
<li class="chapter" data-level="5.6" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#medians-and-modes-of-continuous-variables"><i class="fa fa-check"></i><b>5.6</b> Medians and modes of continuous variables</a></li>
<li class="chapter" data-level="5.7" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#example-recoding-the-education-variable"><i class="fa fa-check"></i><b>5.7</b> Example: recoding the education variable</a></li>
<li class="chapter" data-level="5.8" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#measures-of-dispersion---variance-and-standard-deviation"><i class="fa fa-check"></i><b>5.8</b> Measures of dispersion - variance and standard deviation</a></li>
<li class="chapter" data-level="5.9" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#handling-outliers"><i class="fa fa-check"></i><b>5.9</b> Handling outliers</a></li>
<li class="chapter" data-level="5.10" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#understanding-the-distributions-of-categorical-variables"><i class="fa fa-check"></i><b>5.10</b> Understanding the distributions of categorical variables</a></li>
<li class="chapter" data-level="5.11" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#worked-example-1-exploring-the-distribution-of-satisfaction-variable"><i class="fa fa-check"></i><b>5.11</b> Worked example 1: Exploring the distribution of satisfaction variable</a></li>
<li class="chapter" data-level="5.12" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#group-summary"><i class="fa fa-check"></i><b>5.12</b> Group summary</a></li>
<li class="chapter" data-level="5.13" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#worked-example-2-investigating-bmi-in-south-africa"><i class="fa fa-check"></i><b>5.13</b> Worked example 2: Investigating BMI in South Africa</a></li>
<li class="chapter" data-level="5.14" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#question-answers-3"><i class="fa fa-check"></i><b>5.14</b> Question answers</a></li>
<li class="chapter" data-level="5.15" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#exercises-2"><i class="fa fa-check"></i><b>5.15</b> Exercises</a></li>
<li class="chapter" data-level="5.16" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#exercise-answers-1"><i class="fa fa-check"></i><b>5.16</b> Exercise answers</a></li>
<li class="chapter" data-level="5.17" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#exercises-3"><i class="fa fa-check"></i><b>5.17</b> Exercises</a></li>
<li class="chapter" data-level="5.18" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#exercise-answers-2"><i class="fa fa-check"></i><b>5.18</b> Exercise answers</a></li>
<li class="chapter" data-level="5.19" data-path="measures-of-central-tendency-and-variability.html"><a href="measures-of-central-tendency-and-variability.html#session-information-3"><i class="fa fa-check"></i><b>5.19</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html"><i class="fa fa-check"></i><b>6</b> Bivariate analysis (cross tabs)</a><ul>
<li class="chapter" data-level="6.1" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#getting-ready-2"><i class="fa fa-check"></i><b>6.1</b> Getting ready</a></li>
<li class="chapter" data-level="6.2" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#introduction-5"><i class="fa fa-check"></i><b>6.2</b> Introduction</a></li>
<li class="chapter" data-level="6.3" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#cross---tabulation"><i class="fa fa-check"></i><b>6.3</b> Cross - tabulation</a></li>
<li class="chapter" data-level="6.4" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-1-where-do-households-with-an-elderly-member-tend-to-live"><i class="fa fa-check"></i><b>6.4</b> Example 1: Where do households with an elderly member tend to live?</a></li>
<li class="chapter" data-level="6.5" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-2-is-there-a-relationship-between-the-race-of-a-household-and-the-average-age-of-the-household"><i class="fa fa-check"></i><b>6.5</b> Example 2: Is there a relationship between the race of a household and the average age of the household?</a></li>
<li class="chapter" data-level="6.6" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-3-does-the-level-of-satisfaction-differ-in-different-racegender-groupings"><i class="fa fa-check"></i><b>6.6</b> Example 3: Does the level of satisfaction differ in different race/gender groupings?</a></li>
<li class="chapter" data-level="6.7" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-4-comparing-household-monthly-income-from-the-labour-market-to-individual-monthly-takehome-pay"><i class="fa fa-check"></i><b>6.7</b> Example 4: Comparing Household Monthly Income from the labour market to individual monthly takehome pay</a></li>
<li class="chapter" data-level="6.8" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#chi-squared-testing-for-independence"><i class="fa fa-check"></i><b>6.8</b> Chi-Squared: testing for independence</a></li>
<li class="chapter" data-level="6.9" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#cross-tabs-and-hypothesis-testing-chi2-examples-the-comparative-level-of-happiness-variable"><i class="fa fa-check"></i><b>6.9</b> Cross-tabs and hypothesis testing (Chi^2) examples: The comparative level of happiness variable</a><ul>
<li class="chapter" data-level="6.9.1" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-1-comparative-happiness-and-employment-status"><i class="fa fa-check"></i><b>6.9.1</b> Example 1: Comparative happiness and employment status</a></li>
<li class="chapter" data-level="6.9.2" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-2-comparative-happiness-by-province"><i class="fa fa-check"></i><b>6.9.2</b> Example 2: Comparative happiness by province</a></li>
<li class="chapter" data-level="6.9.3" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-3-comparative-happiness-and-household-income"><i class="fa fa-check"></i><b>6.9.3</b> Example 3: Comparative happiness and household income</a></li>
<li class="chapter" data-level="6.9.4" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#example-4-comparative-happiness-and-geo-type"><i class="fa fa-check"></i><b>6.9.4</b> Example 4: Comparative happiness and geo-type</a></li>
</ul></li>
<li class="chapter" data-level="6.10" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#worked-example-assessing-the-impact-of-per-capita-income-on-bmi"><i class="fa fa-check"></i><b>6.10</b> Worked Example: Assessing the impact of per capita income on BMI</a></li>
<li class="chapter" data-level="6.11" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#question-answers-4"><i class="fa fa-check"></i><b>6.11</b> Question Answers</a></li>
<li class="chapter" data-level="6.12" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#exercises-4"><i class="fa fa-check"></i><b>6.12</b> Exercises</a></li>
<li class="chapter" data-level="6.13" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#exercise-answers-3"><i class="fa fa-check"></i><b>6.13</b> Exercise answers</a></li>
<li class="chapter" data-level="6.14" data-path="bivariate-analysis-cross-tabs.html"><a href="bivariate-analysis-cross-tabs.html#session-information-4"><i class="fa fa-check"></i><b>6.14</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html"><i class="fa fa-check"></i><b>7</b> Simple regression analysis</a><ul>
<li class="chapter" data-level="7.1" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#getting-ready-3"><i class="fa fa-check"></i><b>7.1</b> Getting ready</a></li>
<li class="chapter" data-level="7.2" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#introduction-6"><i class="fa fa-check"></i><b>7.2</b> Introduction</a></li>
<li class="chapter" data-level="7.3" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#correlation-of-variables"><i class="fa fa-check"></i><b>7.3</b> Correlation of variables</a></li>
<li class="chapter" data-level="7.4" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#outliers"><i class="fa fa-check"></i><b>7.4</b> Outliers</a></li>
<li class="chapter" data-level="7.5" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#simple-regression"><i class="fa fa-check"></i><b>7.5</b> Simple regression</a></li>
<li class="chapter" data-level="7.6" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#understanding-regression-output-tables"><i class="fa fa-check"></i><b>7.6</b> Understanding regression output tables</a></li>
<li class="chapter" data-level="7.7" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#graphing-the-regression-equation"><i class="fa fa-check"></i><b>7.7</b> Graphing the regression equation</a></li>
<li class="chapter" data-level="7.8" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#worked-example-is-age-a-strong-determinant-of-bmi"><i class="fa fa-check"></i><b>7.8</b> Worked example: Is age a strong determinant of BMI?</a></li>
<li class="chapter" data-level="7.9" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#question-answers-5"><i class="fa fa-check"></i><b>7.9</b> Question answers:</a></li>
<li class="chapter" data-level="7.10" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#exercises-5"><i class="fa fa-check"></i><b>7.10</b> Exercises</a></li>
<li class="chapter" data-level="7.11" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#exercise-1"><i class="fa fa-check"></i><b>7.11</b> Exercise</a></li>
<li class="chapter" data-level="7.12" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#exercise-answers-4"><i class="fa fa-check"></i><b>7.12</b> Exercise answers</a></li>
<li class="chapter" data-level="7.13" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#appendix-a-analysis-of-variance-anova-table"><i class="fa fa-check"></i><b>7.13</b> Appendix A: Analysis of variance (anova) table</a></li>
<li class="chapter" data-level="7.14" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#appendix-b-further-understanding-the-regression-results-table"><i class="fa fa-check"></i><b>7.14</b> Appendix B: Further understanding the regression results table</a></li>
<li class="chapter" data-level="7.15" data-path="simple-regression-analysis.html"><a href="simple-regression-analysis.html#session-information-5"><i class="fa fa-check"></i><b>7.15</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html"><i class="fa fa-check"></i><b>8</b> Multiple regression analysis</a><ul>
<li class="chapter" data-level="8.1" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#getting-ready-4"><i class="fa fa-check"></i><b>8.1</b> Getting ready</a></li>
<li class="chapter" data-level="8.2" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#introduction-7"><i class="fa fa-check"></i><b>8.2</b> Introduction</a></li>
<li class="chapter" data-level="8.3" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#dummy-variables"><i class="fa fa-check"></i><b>8.3</b> Dummy variables</a></li>
<li class="chapter" data-level="8.4" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#interactions-with-dummy-variables"><i class="fa fa-check"></i><b>8.4</b> Interactions with dummy Variables</a></li>
<li class="chapter" data-level="8.5" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#linear-transformations-of-non-linear-relationships"><i class="fa fa-check"></i><b>8.5</b> Linear transformations of non-linear relationships</a></li>
<li class="chapter" data-level="8.6" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#question-answers-6"><i class="fa fa-check"></i><b>8.6</b> Question Answers</a></li>
<li class="chapter" data-level="8.7" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#exercises-6"><i class="fa fa-check"></i><b>8.7</b> Exercises</a></li>
<li class="chapter" data-level="8.8" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#exercise-answers-5"><i class="fa fa-check"></i><b>8.8</b> Exercise answers</a></li>
<li class="chapter" data-level="8.9" data-path="multiple-regression-analysis.html"><a href="multiple-regression-analysis.html#session-information-6"><i class="fa fa-check"></i><b>8.9</b> Session information</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="further-analysis-and-useful-online-resources.html"><a href="further-analysis-and-useful-online-resources.html"><i class="fa fa-check"></i><b>9</b> Further analysis and useful online resources</a><ul>
<li class="chapter" data-level="9.1" data-path="further-analysis-and-useful-online-resources.html"><a href="further-analysis-and-useful-online-resources.html#further-analyses"><i class="fa fa-check"></i><b>9.1</b> Further analyses</a></li>
<li class="chapter" data-level="9.2" data-path="further-analysis-and-useful-online-resources.html"><a href="further-analysis-and-useful-online-resources.html#useful-online-resources"><i class="fa fa-check"></i><b>9.2</b> Useful online resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Analysis of South African Household Survey Data using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="bivariate-analysis-cross-tabs" class="section level1">
<h1><span class="header-section-number">6</span> Bivariate analysis (cross tabs)</h1>
<div id="getting-ready-2" class="section level2">
<h2><span class="header-section-number">6.1</span> Getting ready</h2>
<p>In the previous chapters we generated some variables and ran some commands that will influence the results that we get in this chapter. If you are starting a new session of R, please run the following lines of code before you begin the chapter. Make sure that you remember what each line of code is doing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(foreign)
<span class="kw">library</span>(tidyverse)</code></pre></div>
<pre><code>## -- Attaching packages ----------------------- tidyverse 1.2.1 --</code></pre>
<pre><code>## v ggplot2 3.0.0     v purrr   0.2.5
## v tibble  1.4.2     v dplyr   0.7.6
## v tidyr   0.8.1     v stringr 1.3.1
## v readr   1.1.1     v forcats 0.3.0</code></pre>
<pre><code>## -- Conflicts -------------------------- tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-<span class="kw">read.dta</span>(<span class="st">&quot;./data/nids.dta&quot;</span>, <span class="dt">convert.factors=</span><span class="ot">FALSE</span>)

nids&lt;-nids<span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(hhid, pid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hhid) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hhrestrict =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">n</span>()) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hhrestrict =</span> <span class="kw">ifelse</span>(hhrestrict<span class="op">==</span><span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))


<span class="co">#Class</span>
nids<span class="op">$</span>class&lt;-<span class="ot">NA</span>
nids<span class="op">$</span>class[<span class="kw">which</span>(nids<span class="op">$</span>w1_fwag<span class="op">&lt;=</span><span class="dv">1500</span>)]&lt;-<span class="dv">1</span>
nids<span class="op">$</span>class[<span class="kw">which</span>(nids<span class="op">$</span>w1_fwag<span class="op">&gt;</span><span class="dv">1500</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_fwag<span class="op">&lt;=</span><span class="dv">4500</span>)]&lt;-<span class="dv">2</span>
nids<span class="op">$</span>class[<span class="kw">which</span>(nids<span class="op">$</span>w1_fwag<span class="op">&gt;</span><span class="dv">4500</span>)]&lt;-<span class="dv">3</span>

nids<span class="op">$</span>class&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>class, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Lower Class&quot;</span>,<span class="st">&quot;Middle Class&quot;</span>,<span class="st">&quot;Upper Class&quot;</span>))


###Creating a BMI variable - from chapter 2 ***

<span class="co">#Height</span>
nids&lt;-nids <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">height =</span> <span class="kw">ifelse</span> (w1_a_n1_<span class="dv">1</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>w1_a_best_age_yrs <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>, w1_a_n1_<span class="dv">1</span><span class="op">/</span><span class="dv">100</span>, <span class="ot">NA</span>))

<span class="co">#Weight</span>
nids&lt;-nids <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">weight =</span> <span class="kw">ifelse</span> (w1_a_n2_<span class="dv">1</span> <span class="op">&gt;=</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>w1_a_best_age_yrs <span class="op">&gt;=</span><span class="st"> </span><span class="dv">20</span>, w1_a_n2_<span class="dv">1</span>, <span class="ot">NA</span>)) 

<span class="co">#BMI</span>
nids&lt;-nids <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bmi =</span> weight<span class="op">/</span>height<span class="op">^</span><span class="dv">2</span>)

<span class="co">#Valid BMI values</span>
nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">bmi_valid =</span> <span class="kw">ifelse</span>(bmi <span class="op">&gt;</span><span class="st"> </span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>bmi <span class="op">&lt;</span><span class="st"> </span><span class="dv">50</span>,<span class="dv">1</span>,<span class="ot">NA</span>))

<span class="co">#BMI bins</span>
nids<span class="op">$</span>bmi.bins.nolabel&lt;-<span class="ot">NA</span>
nids<span class="op">$</span>bmi.bins.nolabel[<span class="kw">which</span>(nids<span class="op">$</span>bmi<span class="op">&gt;=</span><span class="dv">15</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>bmi<span class="op">&lt;</span><span class="fl">18.5</span>)]&lt;-<span class="dv">1</span>
nids<span class="op">$</span>bmi.bins.nolabel[<span class="kw">which</span>(nids<span class="op">$</span>bmi<span class="op">&gt;=</span><span class="fl">18.5</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>bmi<span class="op">&lt;</span><span class="dv">25</span>)]&lt;-<span class="dv">2</span>
nids<span class="op">$</span>bmi.bins.nolabel[<span class="kw">which</span>(nids<span class="op">$</span>bmi<span class="op">&gt;=</span><span class="dv">25</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>bmi<span class="op">&lt;</span><span class="dv">30</span>)]&lt;-<span class="dv">3</span>
nids<span class="op">$</span>bmi.bins.nolabel[<span class="kw">which</span>(nids<span class="op">$</span>bmi<span class="op">&gt;=</span><span class="dv">30</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>bmi<span class="op">&lt;=</span><span class="dv">50</span>)]&lt;-<span class="dv">4</span>

nids<span class="op">$</span>bmi.bins&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>bmi.bins.nolabel, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Underweight&quot;</span>,<span class="st">&quot;Normal&quot;</span>, <span class="st">&quot;Overweight&quot;</span>, <span class="st">&quot;Obese&quot;</span>))

<span class="co">#Age</span>
nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age_adult =</span> <span class="kw">ifelse</span>(w1_a_best_age_yrs<span class="op">&lt;</span><span class="dv">0</span>,<span class="ot">NA</span>, w1_a_best_age_yrs))

<span class="co">#Age bins</span>
nids<span class="op">$</span>age_bins&lt;-<span class="ot">NA</span>
nids<span class="op">$</span>age_bins[<span class="kw">which</span>(nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&gt;=</span><span class="dv">20</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&lt;=</span><span class="dv">29</span>)]&lt;-<span class="dv">1</span>
nids<span class="op">$</span>age_bins[<span class="kw">which</span>(nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&gt;</span><span class="dv">29</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&lt;=</span><span class="dv">39</span>)]&lt;-<span class="dv">2</span>
nids<span class="op">$</span>age_bins[<span class="kw">which</span>(nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&gt;</span><span class="dv">39</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&lt;=</span><span class="dv">49</span>)]&lt;-<span class="dv">3</span>
nids<span class="op">$</span>age_bins[<span class="kw">which</span>(nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&gt;</span><span class="dv">49</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&lt;=</span><span class="dv">59</span>)]&lt;-<span class="dv">4</span>
nids<span class="op">$</span>age_bins[<span class="kw">which</span>(nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&gt;</span><span class="dv">59</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&lt;=</span><span class="dv">69</span>)]&lt;-<span class="dv">5</span>
nids<span class="op">$</span>age_bins[<span class="kw">which</span>(nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&gt;</span><span class="dv">69</span> <span class="op">&amp;</span><span class="st"> </span>nids<span class="op">$</span>w1_r_best_age_yrs<span class="op">&lt;=</span><span class="dv">120</span>)]&lt;-<span class="dv">6</span>

nids<span class="op">$</span>age_bins &lt;-<span class="st"> </span><span class="kw">factor</span>(nids<span class="op">$</span>age_bins, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;20 - 29 yrs&quot;</span>,<span class="st">&quot;30 - 39 yrs&quot;</span>, <span class="st">&quot;40 - 49 yrs&quot;</span>, <span class="st">&quot;50 - 59 yrs&quot;</span>, <span class="st">&quot;60 - 69 yrs&quot;</span>, <span class="st">&quot;70 - 120 yrs&quot;</span>))

<span class="co">#Rename</span>
nids &lt;-<span class="st"> </span>nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">race =</span> w1_best_race,
        <span class="dt">age =</span> w1_r_best_age_yrs,
        <span class="dt">gender =</span> w1_r_b4,
        <span class="dt">province =</span> w1_hhprov, 
        <span class="dt">hhincome =</span> w1_hhincome) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender =</span> <span class="kw">factor</span>(gender, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Male&quot;</span>, <span class="st">&quot;Female&quot;</span>)),
         <span class="dt">race =</span> <span class="kw">factor</span>(race, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;African&quot;</span>, <span class="st">&quot;Coloured&quot;</span>,<span class="st">&quot;Asian&quot;</span>, <span class="st">&quot;White&quot;</span>)),
         <span class="dt">province =</span> <span class="kw">factor</span>(province, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Western Cape&quot;</span>,<span class="st">&quot;Eastern Cape&quot;</span>,<span class="st">&quot;Northern Cape&quot;</span>,<span class="st">&quot;Free State&quot;</span>,<span class="st">&quot;KwaZulu-Natal&quot;</span>,<span class="st">&quot;North West&quot;</span>,<span class="st">&quot;Gauteng&quot;</span>,<span class="st">&quot;Mpumalanga&quot;</span>,<span class="st">&quot;Limpopo&quot;</span>)),
         <span class="dt">w1_hhgeo =</span> <span class="kw">factor</span>(w1_hhgeo, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Rural formal&quot;</span>, <span class="st">&quot;Tribal authority areas&quot;</span>,<span class="st">&quot;Urban formal&quot;</span>, <span class="st">&quot;Urban informal&quot;</span>)))</code></pre></div>
</div>
<div id="introduction-5" class="section level2">
<h2><span class="header-section-number">6.2</span> Introduction</h2>
<p>Up to this point the majority of our analysis has looked at one variable at a time. This is certainly useful, but we will often want to look at how variables interact with one another. Doing this allows us to conduct more in depth analysis of a particular topic. For example, we have learned that to calculate the average monthly pay using R, we type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(nids<span class="op">$</span>w1_fwag)</code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##    20.0   936.7  1600.0  3233.4  3550.0 90000.0   26671</code></pre>
<p>This command gives us the mean for the entire sample. From the output we see that on average individuals earn R3233.36 per month (of those who report earning). When thinking about income, one can think of several factors that may affect what an individual earns.</p>
<p><em>Is it likely that an individual with a university degree will earn a higher wage than an individual with no formal education? Is it likely that an older people earn more on average? How do income levels differ by gender? By race?</em></p>
<p>Hence, while reporting the mean income for the entire sample is useful, examining how income varies by a second variable can be even more helpful in discovering trends in the data. This is an example of Bivariate Analysis. The term Bivariate Analysis sounds rather complicated but do not be intimidated by the name! Below we explain the basics of Bivariate Analysis:</p>
<p><strong>What is bivariate analysis?</strong> Bivariate Analysis is the examination of two variables at the same time, hence the name bivariate. It is used frequently by social scientists and mathematicians to compare how two variables correspond with one another. While sophisticated equations can be written to model how one variable changes with respect other variables (regression, the subject of Chapters 7 and 8), we are concerned here with only two variables, whether they are mathematically related or not.</p>
<p>In this chapter, we will examine the relationship between these two variables (bivariate analysis) using crosstabs. A crosstab is a technique for analyzing the relationship between two variables that have been organized in a bivariate table. Using such a table, we can examine the presence and strength of the relationship between two variables.</p>
<p><strong>When would we use bivariate analysis?</strong> Although it can be used whenever we have two variables that we want to examine at the same time, bivariate analysis is usually a good tool to apply when we have a hunch that two variables “go together.” If this is the case then bivariate analysis allows us to compare them numerically.</p>
<p>For example, if we were interested in poverty across the country, it would be informative to know how much a household spends on food every month.</p>
<p>The variable we want for food expenditure is “<code>w1_h_expf</code> - food expenditure with full imputations”. Now, we could use the <code>head()</code> command and generate a table with the household ID, individual’s personal identification number (<code>pid</code>), and the amount his or her family spends on food every month.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(hhid, pid, w1_h_expf)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">20</span>)</code></pre></div>
<pre><code>## # A tibble: 20 x 3
## # Groups:   hhid [7]
##      hhid    pid w1_h_expf
##     &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;
##  1 101012 314585       223
##  2 101013 314544       173
##  3 101013 314550       173
##  4 101013 406295       173
##  5 101013 406296       173
##  6 101013 406297       173
##  7 101014 301454       442
##  8 101014 314575       442
##  9 101014 314580       442
## 10 101014 314581       442
## 11 101014 314582       442
## 12 101014 406298       442
## 13 101015 314570       200
## 14 101015 406352       200
## 15 101016 314109       530
## 16 101016 314110       530
## 17 101017 314529       167
## 18 101017 314530       167
## 19 101017 314531       167
## 20 101018 314578       671</code></pre>
<p>We can scan the chart to guess a family’s well-being based upon monthly food expenditure, but the amount a family spends on food actually depends on many other things. For instance, we would expect that larger families would spend more on food every month than smaller families because they have more people to feed. In order to answer this question we will need to use the household size variable that we have worked with in previous chapters.</p>
<p>If you can recall, <code>w1_hhsizer</code> is the variable for household size (i.e. number of members). Try listing household size with the previous chart.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(hhid, pid, w1_h_expf, w1_hhsizer)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">20</span>)</code></pre></div>
<pre><code>## # A tibble: 20 x 4
## # Groups:   hhid [7]
##      hhid    pid w1_h_expf w1_hhsizer
##     &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;      &lt;int&gt;
##  1 101012 314585       223          1
##  2 101013 314544       173          5
##  3 101013 314550       173          5
##  4 101013 406295       173          5
##  5 101013 406296       173          5
##  6 101013 406297       173          5
##  7 101014 301454       442          6
##  8 101014 314575       442          6
##  9 101014 314580       442          6
## 10 101014 314581       442          6
## 11 101014 314582       442          6
## 12 101014 406298       442          6
## 13 101015 314570       200          2
## 14 101015 406352       200          2
## 15 101016 314109       530          2
## 16 101016 314110       530          2
## 17 101017 314529       167          3
## 18 101017 314530       167          3
## 19 101017 314531       167          3
## 20 101018 314578       671          1</code></pre>
<p>Now we have some more information that helps us get a better idea of why particular individuals might live in households that spend more money on food. Here, it makes sense that household 101014 would spend more than household 101015 on food because four more people live there. But notice that household size doesn’t always explain the food expenditure we see. (For example compare household 101018 with household 101014). Let’s consider another variable that may influence household food expenditure, such as its monthly income (<code>w1_hhincome</code>). Let us now try listing this variable with total household monthly food expenditure:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(hhid, pid, w1_h_expf, w1_hhincome)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">head</span>(<span class="dv">20</span>)</code></pre></div>
<pre><code>## # A tibble: 20 x 4
## # Groups:   hhid [7]
##      hhid    pid w1_h_expf w1_hhincome
##     &lt;int&gt;  &lt;int&gt;     &lt;dbl&gt;       &lt;dbl&gt;
##  1 101012 314585       223       1045.
##  2 101013 314544       173        588.
##  3 101013 314550       173        588.
##  4 101013 406295       173        588.
##  5 101013 406296       173        588.
##  6 101013 406297       173        588.
##  7 101014 301454       442       1307.
##  8 101014 314575       442       1307.
##  9 101014 314580       442       1307.
## 10 101014 314581       442       1307.
## 11 101014 314582       442       1307.
## 12 101014 406298       442       1307.
## 13 101015 314570       200        291.
## 14 101015 406352       200        291.
## 15 101016 314109       530       1304.
## 16 101016 314110       530       1304.
## 17 101017 314529       167        213.
## 18 101017 314530       167        213.
## 19 101017 314531       167        213.
## 20 101018 314578       671       1785.</code></pre>
<p>Here, it makes sense that household 101012 spends more money than 101013 on food because they have more money to begin with. Although we can’t be sure that a relationship exists between the variables, we can get a general feel for the relationship between the variables by doing bivariate analysis. Later we will expand these techniques to include three (trivariate) and four (quadivariate) variables.</p>
<p>We have introduced the idea of bivariate analysis using the <code>head()</code>/<code>View()</code> commands. While these commands are simple in some respects, it is rather overwhelming when dealing with large numbers of observations and it is also not the most informative when we are trying to look at more than one variable at a time. In the above example, we know that household 101012 spends more on food every month than 101013 and, in addition, that household 101012 has a higher income. But to make any solid conclusions, we have to search up and down the large list of observations trying to find other examples that fit our hypotheses. This process is tedious and time consuming. We would never want to do it with all of the households in the sample.</p>
</div>
<div id="cross---tabulation" class="section level2">
<h2><span class="header-section-number">6.3</span> Cross - tabulation</h2>
<p><strong>So how do we do bivariate analysis in R?</strong> Thank goodness there is another option - cross-tabulations. Suppose we want to look at how adult females perceive their health status compared to adult males. We should start by finding the variables. The two variables are: <code>w1_r_b4</code> (Gender of household member) and <code>w1_a_j1</code> (Respondent’s perceived health status). We can tabulate each variable individually, but that isn’t very helpful when trying to figure out how the two variables are related. There is only so much we can learn from tabulating each of these variables individually.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(w1_r_b4)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   w1_r_b4     n
##     &lt;int&gt; &lt;int&gt;
## 1       1 14643
## 2       2 16527</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(w1_a_j1)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 9 x 2
##   w1_a_j1     n
##     &lt;int&gt; &lt;int&gt;
## 1      -9    21
## 2      -8     3
## 3      -3    71
## 4       1  4554
## 5       2  3927
## 6       3  3757
## 7       4  2058
## 8       5  1248
## 9      NA 15531</code></pre>
<p>That’s a good start, but we still haven’t tabulated the two variables together. A bivariate table (or crosstab) is simply a table that displays the distribution of one variable “across” the categories of a second variable. There are several ways to create a bivariate table in R: <code>xtabs()</code> (<code>stats</code> package), <code>genTable()</code>(<code>memisc</code> package <span class="citation">(Elff <a href="#ref-R-memisc">2017</a>)</span>), <code>CrossTable()</code> (<code>descr</code> <span class="citation">(Dirk Enzmann et al. <a href="#ref-R-descr">2018</a>)</span> or <code>gmodels</code> <span class="citation">(Bolker et al. <a href="#ref-R-gmodels">2018</a>)</span> package), <code>group_by</code> and <code>summarise()</code> (<code>dplyr</code> <span class="citation">(Wickham, François, et al. <a href="#ref-R-dplyr">2018</a>)</span> package) e.t.c.</p>
<p>We are going to use <code>CrossTable()</code> from the gmodels package. The first variable is treated as the row variable and the second is the column variable (see command description from the package documentation). Let us first tidy the perceived health status variable:</p>
<div class="figure"><span id="fig:phealth"></span>
<img src="images/phealth.PNG" alt="Labels for Perceived Health Status" width="156" height="80%" />
<p class="caption">
Figure 6.1: Labels for Perceived Health Status
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(nids<span class="op">$</span>w1_a_j1)</code></pre></div>
<pre><code>## 
##   -9   -8   -3    1    2    3    4    5 
##   21    3   71 4554 3927 3757 2058 1248</code></pre>
<p>We see negative values for different types of missing and we can recode these to NA - missing and make it a factor.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">$</span>phealth&lt;-<span class="kw">ifelse</span>(nids<span class="op">$</span>w1_a_j1<span class="op">&gt;</span><span class="dv">0</span>, nids<span class="op">$</span>w1_a_j1, <span class="ot">NA</span>)
nids<span class="op">$</span>phealth&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>phealth, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;Excellent&quot;</span>, <span class="st">&quot;Very Good&quot;</span>, <span class="st">&quot;Good&quot;</span>, <span class="st">&quot;Fair&quot;</span>, <span class="st">&quot;Poor&quot;</span>))
<span class="kw">table</span>(nids<span class="op">$</span>phealth)</code></pre></div>
<pre><code>## 
## Excellent Very Good      Good      Fair      Poor 
##      4554      3927      3757      2058      1248</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(gmodels)
<span class="kw">CrossTable</span>(nids<span class="op">$</span>phealth, nids<span class="op">$</span>gender)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## | Chi-square contribution |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  15544 
## 
##  
##              | nids$gender 
## nids$phealth |      Male |    Female | Row Total | 
## -------------|-----------|-----------|-----------|
##    Excellent |      2136 |      2418 |      4554 | 
##              |    52.050 |    34.890 |           | 
##              |     0.469 |     0.531 |     0.293 | 
##              |     0.342 |     0.260 |           | 
##              |     0.137 |     0.156 |           | 
## -------------|-----------|-----------|-----------|
##    Very Good |      1662 |      2265 |      3927 | 
##              |     4.698 |     3.149 |           | 
##              |     0.423 |     0.577 |     0.253 | 
##              |     0.266 |     0.243 |           | 
##              |     0.107 |     0.146 |           | 
## -------------|-----------|-----------|-----------|
##         Good |      1362 |      2395 |      3757 | 
##              |    14.086 |     9.442 |           | 
##              |     0.363 |     0.637 |     0.242 | 
##              |     0.218 |     0.257 |           | 
##              |     0.088 |     0.154 |           | 
## -------------|-----------|-----------|-----------|
##         Fair |       676 |      1382 |      2058 | 
##              |    27.207 |    18.237 |           | 
##              |     0.328 |     0.672 |     0.132 | 
##              |     0.108 |     0.149 |           | 
##              |     0.043 |     0.089 |           | 
## -------------|-----------|-----------|-----------|
##         Poor |       402 |       846 |      1248 | 
##              |    19.505 |    13.075 |           | 
##              |     0.322 |     0.678 |     0.080 | 
##              |     0.064 |     0.091 |           | 
##              |     0.026 |     0.054 |           | 
## -------------|-----------|-----------|-----------|
## Column Total |      6238 |      9306 |     15544 | 
##              |     0.401 |     0.599 |           | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
<p>By looking at the table above we can see how perceived health status differs between the men and women in the survey. We see that out of the 6238 males who were meant to report their health status (i.e. not NA-missing), 2136 said their health status was excellent and 402 said it was poor. In general it seems that the results are similar for men and women in the sense that there seems to be a strong tendency for respondents to have a positive perception of their health. The majority of respondents, both male and female, perceived their health status to be above “Good”. However, since we can see that the number of women who answered this question (9306 excluding missing) is much larger than the number of men (6238), it is difficult to compare them accurately by simply looking at the counts.</p>
<p>We can look at <code>N / Col Total</code>, that is the column proportions for each gender.We see that about 0.342 (34.2%) of men ({2136÷6238}×100) perceive their health to be “Excellent” compared to only 0.26 (26%) ({2418÷9306}×100) of women, suggesting that women may be more somewhat more critical of their health.</p>
<p>Let’s try another example to answer one of the questions from the beginning of the chapter.</p>
<p><em>Is it likely that an individual with a university degree or higher will earn a higher wage than an individual with no form of university education?</em></p>
<p>Here it is important to first pay attention to the types of variables we are working with. Education is a categorical variable, while income tends to be a continuous variable.</p>
<p>We decided to divide the sample into those who have a university degree and those who do not. We can accomplish this by creating a dummy variable from <code>w1_r_b7</code>.</p>
<div class="figure">
<img src="images/best_edu.PNG" alt="Education codes" width="146" />
<p class="caption">
(#fig:best_edu)Education codes
</p>
</div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">$</span>uni&lt;-<span class="dv">1</span>
nids<span class="op">$</span>uni[nids<span class="op">$</span>w1_r_b7 <span class="op">==</span><span class="st"> </span><span class="dv">20</span> <span class="op">|</span><span class="st"> </span>nids<span class="op">$</span>w1_r_b7 <span class="op">==</span><span class="st"> </span><span class="dv">21</span> <span class="op">|</span><span class="st"> </span>nids<span class="op">$</span>w1_r_b7 <span class="op">==</span><span class="st"> </span><span class="dv">22</span> <span class="op">|</span><span class="st"> </span>nids<span class="op">$</span>w1_r_b7 <span class="op">==</span><span class="st"> </span><span class="dv">23</span>]&lt;-<span class="dv">2</span>
nids<span class="op">$</span>uni[nids<span class="op">$</span>w1_r_b7<span class="op">&lt;</span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span><span class="kw">is.na</span>(nids<span class="op">$</span>w1_r_b7)]&lt;-<span class="ot">NA</span>
nids<span class="op">$</span>uni&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>uni, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels=</span> <span class="kw">c</span>(<span class="st">&quot;no bachelor degree&quot;</span>,<span class="st">&quot;bachelor degree&quot;</span>))
<span class="kw">table</span>(nids<span class="op">$</span>uni)</code></pre></div>
<pre><code>## 
## no bachelor degree    bachelor degree 
##              30337                371</code></pre>
<p><strong>Method 1</strong> - using <code>w1_fwag</code> (monthly take home pay)</p>
<p>Now we can summarise <code>w1_fwag</code> on the new <code>uni</code> education variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(w1_fwag <span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(w1_fwag)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(uni) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean_inc=</span><span class="kw">mean</span>(w1_fwag, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">sd_inc=</span><span class="kw">sd</span>(w1_fwag, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">N=</span><span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   uni                mean_inc sd_inc     N
##   &lt;fct&gt;                 &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
## 1 no bachelor degree    2844.  4373.  4249
## 2 bachelor degree      12194. 11588.   194
## 3 &lt;NA&gt;                  1764.  1711.    56</code></pre>
<p>From the table, the average monthly income for University graduates is over 4 times that of people without a bachelor’s degree.</p>
<p><strong>Method 2</strong> - using derived <code>class</code> variable</p>
<p>First, we want to reacquaint ourselves with the <code>class</code> variable that we created in the previous chapter (you should have it in your dataset from running the ‘getting ready’ commands). Can you remember whether a 1 is ‘upper class’ or ‘lower class’? Luckily, we gave the variable a value label to remind us:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(nids<span class="op">$</span>class)</code></pre></div>
<pre><code>## 
##  Lower Class Middle Class  Upper Class 
##         2167         1503          829</code></pre>
<p>Since, we already have our categorical/factor income variable, we are in a position to run a cross‐tab of income and our university indicator variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CrossTable</span>(nids<span class="op">$</span>uni, nids<span class="op">$</span>class)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## | Chi-square contribution |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  4443 
## 
##  
##                    | nids$class 
##           nids$uni |  Lower Class | Middle Class |  Upper Class |    Row Total | 
## -------------------|--------------|--------------|--------------|--------------|
## no bachelor degree |         2131 |         1454 |          664 |         4249 | 
##                    |        3.985 |        0.951 |       20.358 |              | 
##                    |        0.502 |        0.342 |        0.156 |        0.956 | 
##                    |        0.999 |        0.981 |        0.803 |              | 
##                    |        0.480 |        0.327 |        0.149 |              | 
## -------------------|--------------|--------------|--------------|--------------|
##    bachelor degree |            3 |           28 |          163 |          194 | 
##                    |       87.276 |       20.826 |      445.884 |              | 
##                    |        0.015 |        0.144 |        0.840 |        0.044 | 
##                    |        0.001 |        0.019 |        0.197 |              | 
##                    |        0.001 |        0.006 |        0.037 |              | 
## -------------------|--------------|--------------|--------------|--------------|
##       Column Total |         2134 |         1482 |          827 |         4443 | 
##                    |        0.480 |        0.334 |        0.186 |              | 
## -------------------|--------------|--------------|--------------|--------------|
## 
## </code></pre>
<p>As we have mentioned before, dividing income into three arbitrary categories is rather crude. Nevertheless, it gives us a clear pattern regarding the relationship between having a university degree and the income level achieved in the sample. Looking along the first row of <code>N</code>, we see that the majority of people without a bachelors degree are in the ‘lower class’ income bracket. In contrast, looking along the second row we see that the vast majority of people with a bachelors degree are in the ‘upper class’ income bracket. It is useful to notice that you can interpret the table in a different way by looking at the columns. For instance, if we look at the third column we see that the majority of upper class people don’t have a bachelor’s degree (i.e. 664 out of the 827 in the ‘upper class’ income bracket don’t have a bachelor’s degree).</p>
<p>We can also look at this in terms of column percentage <code>N / Col Total</code> or row percentage <code>N / Row Total</code>, the third and fourth row in each cell. For example, 80.3 percent of “Upper Class” do not have a bachelor’s degree or that 15.6% of those with no bachelor’s degree are in upper class.</p>
<p>Now that you’ve learned these new methods, try answering the following questions:</p>
<p><strong>1. How many people live in a house connected to electricity but still use wood as their main energy source for heating?</strong></p>
<p>Question 1 Answer</p>
<p><strong>2. In what province is English most widely spoken?</strong></p>
<p>Question 2 Answer</p>
</div>
<div id="example-1-where-do-households-with-an-elderly-member-tend-to-live" class="section level2">
<h2><span class="header-section-number">6.4</span> Example 1: Where do households with an elderly member tend to live?</h2>
<p>In order to answer this question, we will first want to create a household level variable that assigns the age of the oldest member of the household to every member of the household. It is not a simple task at all - in fact you are probably unable to do it with only the commands that you have learned so far. Luckily, the <code>dplyr</code> package provides us with a quick and simple way to do tasks of this nature. In this case, we use the <strong>dplyr</strong> command to calculate the oldest age within each household and return the result in a data frame:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">maxage =</span> <span class="kw">max</span>(w1_r_best_age_yrs, <span class="dt">na.rm =</span> T))</code></pre></div>
<p>Let’s examine more closely what this command tells R to do. We group nids data by the <code>hhid</code> variable and generating a new variable called <code>maxage</code> (<code>=max(w1_r_best_age_yrs)</code>) that is the maximum value of the <code>w1_r_best_age_yrs</code> variable in each unique <code>hhid</code>. Therefore R assigns every individual in the household a value that is equivalent to the oldest age of the person in that individual’s household.</p>
<p>In summary, this line of commands tells R to generate a new variable called maxage and to assign it the value of the maximum age within the household for every member of the household. To verify this command, type the command:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(nids[,<span class="kw">c</span>(<span class="st">&quot;hhid&quot;</span>, <span class="st">&quot;w1_r_best_age_yrs&quot;</span>, <span class="st">&quot;maxage&quot;</span>)], <span class="dt">n =</span> 25L)</code></pre></div>
<pre><code>## # A tibble: 25 x 3
## # Groups:   hhid [8]
##      hhid w1_r_best_age_yrs maxage
##     &lt;int&gt;             &lt;int&gt;  &lt;int&gt;
##  1 101012                51     51
##  2 101013                45     45
##  3 101013                32     45
##  4 101013                 9     45
##  5 101013                13     45
##  6 101013                11     45
##  7 101014                15     62
##  8 101014                25     62
##  9 101014                60     62
## 10 101014                22     62
## # ... with 15 more rows</code></pre>
<p>We now have a variable that is the age of the oldest person in each household. It would be possible to run a simple cross tab now, but those results would be incorrect without controlling for the number bias (we only want to count each household once). Thus, we need to correct for that:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids_max_age&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(hhrestrict<span class="op">==</span><span class="dv">1</span>)

<span class="co">#CrossTable(nids_max_age$maxage, nids_max_age$w1_hhgeo, expected = FALSE, prop.r = FALSE, prop.c = FALSE, prop.t = FALSE,prop.chisq = FALSE)</span></code></pre></div>
<p>For easy of printing to screen, we decided to shorten the level labels for <code>w1_hhgeo</code> to:</p>
<p><code>RF</code> - Rural formal</p>
<p><code>TAA</code> - Tribal authority areas</p>
<p><code>UF</code> - Urban formal</p>
<p><code>UI</code> - Urban informal</p>
<p>and create a new <code>w1_hhgeo1</code> variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids_max_age<span class="op">$</span>w1_hhgeo1&lt;-nids_max_age<span class="op">$</span>w1_hhgeo
<span class="kw">levels</span>(nids_max_age<span class="op">$</span>w1_hhgeo1)&lt;-<span class="kw">c</span>(<span class="st">&#39;RF&#39;</span>,<span class="st">&#39;TAA&#39;</span>,<span class="st">&#39;UF&#39;</span>,<span class="st">&#39;UI&#39;</span>)
<span class="kw">CrossTable</span>(nids_max_age<span class="op">$</span>maxage, nids_max_age<span class="op">$</span>w1_hhgeo1, <span class="dt">expected =</span> <span class="ot">FALSE</span>, <span class="dt">prop.r =</span> <span class="ot">FALSE</span>, <span class="dt">prop.c =</span> <span class="ot">FALSE</span>, <span class="dt">prop.t =</span> <span class="ot">FALSE</span>,<span class="dt">prop.chisq =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |-------------------------|
## 
##  
## Total Observations in Table:  7305 
## 
##  
##                     | nids_max_age$w1_hhgeo1 
## nids_max_age$maxage |        RF |       TAA |        UF |        UI | Row Total | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  -9 |         6 |         3 |         6 |         0 |        15 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  -8 |         0 |         0 |         1 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  -3 |         1 |         0 |         0 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                   8 |         0 |         1 |         0 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                   9 |         0 |         1 |         0 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  12 |         0 |         1 |         0 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  14 |         0 |         1 |         0 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  15 |         0 |         2 |         4 |         0 |         6 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  16 |         1 |         1 |         1 |         0 |         3 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  17 |         0 |         0 |         1 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  18 |         1 |         8 |         5 |         2 |        16 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  19 |         2 |         9 |        23 |         3 |        37 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  20 |         4 |        13 |        13 |         3 |        33 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  21 |         5 |        12 |        17 |         5 |        39 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  22 |        10 |        12 |        27 |         4 |        53 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  23 |        11 |        13 |        34 |        10 |        68 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  24 |        12 |        15 |        30 |         7 |        64 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  25 |        15 |        16 |        36 |         7 |        74 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  26 |        17 |        21 |        33 |        10 |        81 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  27 |        14 |        15 |        38 |        12 |        79 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  28 |        18 |        23 |        48 |        11 |       100 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  29 |        14 |        29 |        51 |        12 |       106 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  30 |        25 |        25 |        40 |        13 |       103 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  31 |        19 |        22 |        52 |        11 |       104 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  32 |        17 |        29 |        59 |        16 |       121 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  33 |        18 |        39 |        66 |         9 |       132 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  34 |        19 |        33 |        65 |        12 |       129 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  35 |        17 |        43 |        68 |         9 |       137 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  36 |        25 |        29 |        64 |        12 |       130 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  37 |        19 |        43 |        87 |        12 |       161 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  38 |        24 |        36 |        68 |        13 |       141 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  39 |        19 |        39 |        80 |        16 |       154 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  40 |        20 |        43 |        79 |        10 |       152 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  41 |        22 |        35 |        87 |        13 |       157 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  42 |        21 |        50 |        82 |         7 |       160 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  43 |        17 |        49 |        95 |         9 |       170 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  44 |        22 |        55 |        97 |        15 |       189 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  45 |        23 |        50 |        63 |        11 |       147 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  46 |        18 |        61 |        74 |        15 |       168 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  47 |        17 |        59 |        80 |        10 |       166 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  48 |        12 |        61 |        90 |         9 |       172 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  49 |        20 |        51 |        75 |         8 |       154 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  50 |        17 |        61 |        77 |         9 |       164 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  51 |        27 |        44 |        92 |        13 |       176 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  52 |        12 |        66 |        68 |        11 |       157 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  53 |        15 |        58 |        68 |         7 |       148 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  54 |        12 |        65 |        74 |        17 |       168 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  55 |        20 |        78 |        78 |        12 |       188 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  56 |        21 |        56 |        57 |         7 |       141 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  57 |        13 |        53 |        64 |         5 |       135 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  58 |        10 |        69 |        55 |         4 |       138 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  59 |        14 |        58 |        39 |        10 |       121 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  60 |        11 |        46 |        52 |        11 |       120 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  61 |         8 |        48 |        48 |         7 |       111 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  62 |         9 |        49 |        42 |         5 |       105 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  63 |        11 |        34 |        55 |        10 |       110 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  64 |         9 |        34 |        44 |         2 |        89 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  65 |         6 |        51 |        29 |         5 |        91 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  66 |         4 |        53 |        43 |         5 |       105 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  67 |        12 |        55 |        41 |         7 |       115 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  68 |         9 |        60 |        40 |         4 |       113 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  69 |        11 |        53 |        41 |         2 |       107 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  70 |         7 |        42 |        34 |         2 |        85 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  71 |         6 |        32 |        36 |         5 |        79 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  72 |         5 |        30 |        28 |         1 |        64 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  73 |         6 |        34 |        37 |         1 |        78 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  74 |         4 |        37 |        22 |         1 |        64 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  75 |        10 |        34 |        16 |         4 |        64 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  76 |         4 |        33 |        20 |         3 |        60 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  77 |         1 |        46 |        32 |         4 |        83 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  78 |         7 |        25 |        17 |         4 |        53 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  79 |         7 |        20 |        22 |         4 |        53 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  80 |         4 |        17 |        16 |         2 |        39 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  81 |         2 |        27 |         6 |         0 |        35 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  82 |         2 |        25 |        16 |         1 |        44 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  83 |         2 |        12 |        10 |         0 |        24 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  84 |         1 |         8 |         6 |         1 |        16 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  85 |         2 |         7 |         3 |         0 |        12 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  86 |         1 |        11 |         3 |         0 |        15 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  87 |         1 |        12 |         3 |         1 |        17 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  88 |         1 |        15 |         4 |         1 |        21 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  89 |         0 |         3 |         5 |         2 |        10 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  90 |         3 |         6 |         3 |         0 |        12 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  91 |         0 |         2 |         4 |         0 |         6 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  92 |         0 |         3 |         2 |         0 |         5 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  93 |         0 |         4 |         2 |         0 |         6 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  94 |         1 |         5 |         2 |         0 |         8 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  95 |         1 |         1 |         2 |         0 |         4 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  96 |         0 |         2 |         0 |         0 |         2 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  97 |         1 |         1 |         1 |         1 |         4 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  98 |         0 |         2 |         2 |         1 |         5 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                  99 |         0 |         2 |         0 |         0 |         2 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                 100 |         1 |         0 |         1 |         0 |         2 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                 101 |         0 |         1 |         1 |         0 |         2 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##                 105 |         0 |         1 |         0 |         0 |         1 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
##        Column Total |       856 |      2639 |      3302 |       508 |      7305 | 
## --------------------|-----------|-----------|-----------|-----------|-----------|
## 
## </code></pre>
<p>While there are some interesting households which report having very young members as the oldest in the household, if we examine the table closely it seems that most households with elderly people reside in Tribal Authority Areas and Urban Formal Areas. But if we look at the Total row, we can see that these areas also contain the majority of households. What do you think is the best way to address our question? One way would be to look at the proportion of total households in a given area that have a member over a certain age, say 80.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids_max_age80&lt;-nids_max_age<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(maxage<span class="op">&gt;</span><span class="dv">80</span>)
  
<span class="kw">CrossTable</span>(nids_max_age80<span class="op">$</span>maxage, nids_max_age80<span class="op">$</span>w1_hhgeo1, <span class="dt">expected =</span> <span class="ot">FALSE</span>, <span class="dt">prop.r =</span> <span class="ot">FALSE</span>, <span class="dt">prop.c =</span> <span class="ot">FALSE</span>, <span class="dt">prop.t =</span> <span class="ot">FALSE</span>,<span class="dt">prop.chisq =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |-------------------------|
## 
##  
## Total Observations in Table:  253 
## 
##  
##                       | nids_max_age80$w1_hhgeo1 
## nids_max_age80$maxage |        RF |       TAA |        UF |        UI | Row Total | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    81 |         2 |        27 |         6 |         0 |        35 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    82 |         2 |        25 |        16 |         1 |        44 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    83 |         2 |        12 |        10 |         0 |        24 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    84 |         1 |         8 |         6 |         1 |        16 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    85 |         2 |         7 |         3 |         0 |        12 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    86 |         1 |        11 |         3 |         0 |        15 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    87 |         1 |        12 |         3 |         1 |        17 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    88 |         1 |        15 |         4 |         1 |        21 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    89 |         0 |         3 |         5 |         2 |        10 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    90 |         3 |         6 |         3 |         0 |        12 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    91 |         0 |         2 |         4 |         0 |         6 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    92 |         0 |         3 |         2 |         0 |         5 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    93 |         0 |         4 |         2 |         0 |         6 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    94 |         1 |         5 |         2 |         0 |         8 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    95 |         1 |         1 |         2 |         0 |         4 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    96 |         0 |         2 |         0 |         0 |         2 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    97 |         1 |         1 |         1 |         1 |         4 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    98 |         0 |         2 |         2 |         1 |         5 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                    99 |         0 |         2 |         0 |         0 |         2 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                   100 |         1 |         0 |         1 |         0 |         2 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                   101 |         0 |         1 |         1 |         0 |         2 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##                   105 |         0 |         1 |         0 |         0 |         1 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
##          Column Total |        19 |       150 |        76 |         8 |       253 | 
## ----------------------|-----------|-----------|-----------|-----------|-----------|
## 
## </code></pre>
<p>This gives us a slightly clearer picture as we can see that almost double the number of households with a member over the age of 80 live in Tribal Authorities Areas in comparison to Urban Formal. Nevertheless, let’s calculate the percentage of households with an elderly member in relation to the total number of households in a given area to get more precise results:</p>
<p><strong>Total households</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tothh&lt;-nids_max_age <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(w1_hhgeo) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">hh=</span><span class="kw">n</span>())
tothh</code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   w1_hhgeo                  hh
##   &lt;fct&gt;                  &lt;int&gt;
## 1 Rural formal             856
## 2 Tribal authority areas  2639
## 3 Urban formal            3302
## 4 Urban informal           508</code></pre>
<p><strong>Over 80 households</strong></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tothh80&lt;-nids_max_age80 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(w1_hhgeo) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">hh80=</span><span class="kw">n</span>())
tothh80</code></pre></div>
<pre><code>## # A tibble: 4 x 2
##   w1_hhgeo                hh80
##   &lt;fct&gt;                  &lt;int&gt;
## 1 Rural formal              19
## 2 Tribal authority areas   150
## 3 Urban formal              76
## 4 Urban informal             8</code></pre>
<p>Bind together</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hh&lt;-<span class="kw">cbind</span>(tothh80,tothh[,<span class="dv">2</span>])
hh</code></pre></div>
<pre><code>##                 w1_hhgeo hh80   hh
## 1           Rural formal   19  856
## 2 Tribal authority areas  150 2639
## 3           Urban formal   76 3302
## 4         Urban informal    8  508</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">hh <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">percent=</span><span class="kw">round</span>(hh80<span class="op">/</span>hh<span class="op">*</span><span class="dv">100</span>,<span class="dv">2</span>))</code></pre></div>
<pre><code>##                 w1_hhgeo hh80   hh percent
## 1           Rural formal   19  856    2.22
## 2 Tribal authority areas  150 2639    5.68
## 3           Urban formal   76 3302    2.30
## 4         Urban informal    8  508    1.57</code></pre>
<p>It is clear from this table that the percentage of households containing a member over the age of 80 is far greater in Tribal Authorities Areas. It would be interesting to investigate the reasons for this (Is it simply because households are larger in Tribal Authority Areas? Are young families migrating to the city? Or is there some other reason?), but we will not do that here.</p>
</div>
<div id="example-2-is-there-a-relationship-between-the-race-of-a-household-and-the-average-age-of-the-household" class="section level2">
<h2><span class="header-section-number">6.5</span> Example 2: Is there a relationship between the race of a household and the average age of the household?</h2>
<p>In order to answer this question, the first thing we need to do is create a variable that assigns the average age of the household to every member of the household. The <code>group_by()</code> %&gt;% <code>mutate()</code> command is necessary to do this. Type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">age1 =</span> <span class="kw">ifelse</span>(age<span class="op">&gt;</span><span class="dv">0</span>, age, <span class="ot">NA</span>))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">avgage =</span> <span class="kw">mean</span>(age1, <span class="dt">na.rm=</span>T))</code></pre></div>
<p>Can you work out what each of the parts of the line of command is doing? We first create a variable <code>age1</code> that does not include no-response values or negative values. Then we <code>group_by(hhid)</code> telling R that whatever computation that is going to do will be grouped by <code>hhid</code>. The last <code>mutate</code> command is telling R to create a variable called <code>avgage</code> that gives each person in the sample a value equal to the average age of that individual’s household (<code>hhid</code>).</p>
<p>It is instructive to think about what would happen if we specified the option <strong>group_by(w1_hhgeo)</strong> instead of <strong>group_by(hhid)</strong>? If that were the case, then the command would tell R to create a variable called <code>avgage</code>, which gave each person the value equal to the average age of all the people who live in the same geo‐type. Try it and then check the new variable you create. Make sure you give the new variable you create a different name to <code>avgage</code>.</p>
<p>Moving on with our example, we are working at the household level and therefore we will need a household level race variable. Leaving aside the question of whether it is appropriate to assign a race to an entire household, for simplicity we will use the race of the resident head as the household race. Let’s create a household level race variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hrace =</span> <span class="kw">if_else</span>(w1_r_b3<span class="op">==</span><span class="dv">1</span>, w1_best_race,<span class="ot">NA_integer_</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hhrace =</span> <span class="kw">max</span>(hrace, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))

<span class="kw">table</span>(nids<span class="op">$</span>hhrace)</code></pre></div>
<pre><code>## 
##  -Inf     1     2     3     4 
##  2573 22494  4191   440  1472</code></pre>
<p>What have we done here? In the first <code>mutate</code> we generated a variable <code>hrace</code> that takes on the race value of the head of the household, but it is only assigned this value for the household head (<code>w1_r_b3==1</code>). Every other member of the household is assigned an NA‐missing value. The last <code>mutate()</code> code tells R to create a new variable <code>hhrace</code> and assign every member of the household the maximum value of <code>hrace</code> because we have grouped by <code>hhid</code>. Does this make sense? Surely, we don’t want to take the maximum race in the household - what does maximum race even mean? The trick here is that the first <code>mutate</code> line of code assigns a race value to <code>hrace</code> for <strong>only one</strong> member of every household. Therefore, the maximum is just going to be that solitary value. You could equally well have used the minimum option and achieved the exact same result. We now have our household level race variable and can move on with the example. Before we move on, let’s attach value/factor labels to our new <code>hhrace</code> variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hhrace =</span> <span class="kw">factor</span>(hhrace, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>, <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;African&quot;</span>,<span class="st">&quot;Coloured&quot;</span>,<span class="st">&quot;Asian_Indian&quot;</span>,<span class="st">&quot;White&quot;</span>)))</code></pre></div>
<p>Since we are working at the household level, we use hhrestrict to limit our cross tab to one observation per household. Type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#nids_max_hhrace_age&lt;-nids%&gt;%</span>
<span class="co">#  filter(hhrestrict==1)%&gt;%</span>
<span class="co">#  select(hhrace, avgage)</span>
  
<span class="co">#CrossTable(nids_max_hhrace_age$avgage, nids_max_hhrace_age$hhrace, expected = FALSE, prop.r = FALSE, prop.c = FALSE, prop.t = FALSE,prop.chisq = FALSE)</span></code></pre></div>
<p>Now, we could look through this table and get some sort of indication of the household age distribution by race, but there are really too many entries in the table to draw any meaningful conclusions. In addition to this, we have the same challenge as we did previously where the African column has a far larger total which makes interpretation difficult if we don’t use percentages.</p>
<p>The ideal situation would be to somehow split up the sample into racial categories and then get some sort of summary of the average age distribution in each racial group. While this may seem quite complicated, we can do it by combining tools that we have already learned. Let’s try this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hhrace)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Mini =</span> <span class="kw">min</span>(avgage, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">Mean =</span> <span class="kw">mean</span>(avgage, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">Median =</span> <span class="kw">median</span>(avgage, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">Max =</span> <span class="kw">max</span>(avgage, <span class="dt">na.rm=</span><span class="ot">TRUE</span>),
            <span class="dt">N =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 5 x 6
##   hhrace        Mini  Mean Median   Max     N
##   &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 African       6.5   27.2   25    99   22494
## 2 Coloured     12     29.2   27    91    4191
## 3 Asian_Indian 15     32.1   28    83.5   440
## 4 White         8.33  39.7   35    83    1472
## 5 &lt;NA&gt;          9     25.1   23.8  72    2573</code></pre>
<p><strong>Note</strong>: Stata excludes those with missing age in in both mean and N whereas R includes them in N.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hhrace)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Mini =</span> <span class="kw">min</span>(avgage, <span class="dt">na.rm=</span>T),
            <span class="dt">Mean =</span> <span class="kw">mean</span>(avgage, <span class="dt">na.rm=</span>T),
            <span class="dt">Median =</span> <span class="kw">median</span>(avgage, <span class="dt">na.rm=</span>T),
            <span class="dt">Max =</span> <span class="kw">max</span>(avgage, <span class="dt">na.rm=</span>T),
            <span class="dt">Std.dev =</span> <span class="kw">sd</span>(avgage, <span class="dt">na.rm=</span>T),
            <span class="dt">N =</span> <span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   hhrace        Mini  Mean Median   Max Std.dev     N
##   &lt;fct&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
## 1 African       6.5   27.2   25    99     10.1  22494
## 2 Coloured     12     29.2   27    91     11.0   4191
## 3 Asian_Indian 15     32.1   28    83.5   12.4    440
## 4 White         8.33  39.7   35    83     17.0   1472
## 5 &lt;NA&gt;          9     25.1   23.8  72      7.75  2573</code></pre>
<p>Now, let’s return to the question at hand: is there a relationship between the average age of a household and the race of the household? Given the output above, we have a lot of information that can help us answer this question. One method would be to compare the median or mean of average household age in the different racial groups. For example, the median of average household age in White households is 35, while it is 25 in African households. Basically the median White household has an average age of around 35 - more than ten years more than the median African household. This results are even stronger for the mean. These results suggest a strong relationship between the race of a household and the average age in the household.</p>
<p>Nevertheless, this process of acquiring these results regarding the relationship between household race and household average age has been rather ungainly and the precise relationship is still unclear. We don’t know what is driving this relationship - are the elderly in White households simply living longer than the elderly in African households, or have African households been having more babies than White households in recent years? In order to address these questions and get to understand the determinants of the differing household age composition of the different racial groups, we will need to learn regression analysis. We will do this in chapter 7 and 8.</p>
</div>
<div id="example-3-does-the-level-of-satisfaction-differ-in-different-racegender-groupings" class="section level2">
<h2><span class="header-section-number">6.6</span> Example 3: Does the level of satisfaction differ in different race/gender groupings?</h2>
<p>Here we introduce another useful command: <code>paste</code> (more like equivalent of STATA <code>egen</code>, <code>group()</code>) command to create three variable cross-tabulations. Suppose we are interested in examining the level of satisfaction of each person by race and gender.</p>
<p>We start by cleaning some of the variables</p>
<p>Using the paste command, we can type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">$</span>race.gender&lt;-<span class="kw">paste</span>(nids<span class="op">$</span>race,nids<span class="op">$</span>gender, <span class="dt">sep =</span> <span class="st">&quot;-&quot;</span>)</code></pre></div>
<p>Let’s make sure we understand what we just told R to do. The paste command tells R to concatenate and create a new variable, <code>race.gender</code>, that takes on the combinations African Male, African Female, for the race and gender combinations in our case. Let’s look at the cross tabulation of our cleaned variables <code>race</code> and <code>gender</code> first:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CrossTable</span>(nids<span class="op">$</span>race, nids<span class="op">$</span>gender, <span class="dt">expected =</span> <span class="ot">FALSE</span>, <span class="dt">prop.r =</span> <span class="ot">FALSE</span>, <span class="dt">prop.c =</span> <span class="ot">FALSE</span>, <span class="dt">prop.t =</span> <span class="ot">FALSE</span>,<span class="dt">prop.chisq =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |-------------------------|
## 
##  
## Total Observations in Table:  28194 
## 
##  
##              | nids$gender 
##    nids$race |      Male |    Female | Row Total | 
## -------------|-----------|-----------|-----------|
##      African |     10163 |     11994 |     22157 | 
## -------------|-----------|-----------|-----------|
##     Coloured |      1948 |      2218 |      4166 | 
## -------------|-----------|-----------|-----------|
##        Asian |       202 |       237 |       439 | 
## -------------|-----------|-----------|-----------|
##        White |       683 |       749 |      1432 | 
## -------------|-----------|-----------|-----------|
## Column Total |     12996 |     15198 |     28194 | 
## -------------|-----------|-----------|-----------|
## 
## </code></pre>
<p>Or</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mytable &lt;-<span class="st"> </span><span class="kw">xtabs</span>(<span class="op">~</span>race<span class="op">+</span>gender, <span class="dt">data=</span>nids)
<span class="kw">ftable</span>(mytable)</code></pre></div>
<pre><code>##          gender  Male Female
## race                        
## African         10163  11994
## Coloured         1948   2218
## Asian             202    237
## White             683    749</code></pre>
<p>This simple crosstab tells us the frequency count of each combination of race and gender. For instance, we can see that there are 10163 African Males. Now, let’s look at our newly created variable, <code>race.gender</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(race.gender)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">n</span>())</code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    race.gender         n
##    &lt;chr&gt;           &lt;int&gt;
##  1 African-Female  11994
##  2 African-Male    10163
##  3 Asian-Female      237
##  4 Asian-Male        202
##  5 Coloured-Female  2218
##  6 Coloured-Male    1948
##  7 NA-Female        1329
##  8 NA-Male          1647
##  9 White-Female      749
## 10 White-Male        683</code></pre>
<p>Now we can examine the cross tab of level of satisfaction (<code>w1_a_m5</code>) and our new variable <code>race.gender</code>. This means we will be now examining the difference in the perceived satisfaction of respondents (adults only) by race and gender.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CrossTable</span>(nids<span class="op">$</span>w1_a_m5, nids<span class="op">$</span>race.gender, <span class="dt">expected =</span> <span class="ot">FALSE</span>, <span class="dt">prop.r =</span> <span class="ot">FALSE</span>, <span class="dt">prop.c =</span> <span class="ot">FALSE</span>, <span class="dt">prop.t =</span> <span class="ot">FALSE</span>, <span class="dt">prop.chisq =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |-------------------------|
## 
##  
## Total Observations in Table:  15630 
## 
##  
##              | nids$race.gender 
## nids$w1_a_m5 |  African-Female |    African-Male |    Asian-Female |      Asian-Male | Coloured-Female |   Coloured-Male |       NA-Female |         NA-Male |    White-Female |      White-Male |       Row Total | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##           -9 |             786 |             487 |               4 |               2 |              96 |              37 |               0 |               0 |              12 |               9 |            1433 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##           -8 |              80 |              63 |               0 |               0 |              11 |               5 |               0 |               0 |               1 |               3 |             163 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##           -5 |               2 |               0 |               0 |               0 |               0 |               0 |               0 |               0 |               0 |               0 |               2 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##           -3 |              87 |              62 |               0 |               0 |              52 |              29 |               0 |               0 |               5 |               5 |             240 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            1 |             568 |             370 |               3 |               4 |              29 |              27 |               0 |               1 |               3 |               2 |            1007 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            2 |             407 |             247 |               1 |               1 |              20 |              13 |               1 |               0 |               3 |               8 |             701 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            3 |             736 |             432 |               2 |               3 |              34 |              23 |               0 |               0 |               9 |               7 |            1246 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            4 |            1041 |             622 |               7 |               4 |             103 |              53 |               2 |               0 |              17 |              18 |            1867 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            5 |            1220 |             781 |              28 |              14 |             229 |             166 |               1 |               2 |              65 |              52 |            2558 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            6 |             805 |             599 |              13 |              12 |             146 |             117 |               0 |               1 |              58 |              52 |            1803 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            7 |             647 |             473 |              30 |              18 |             172 |             128 |               1 |               0 |              93 |              71 |            1633 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            8 |             387 |             315 |              33 |              26 |             183 |             104 |               1 |               0 |             146 |             110 |            1305 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##            9 |             142 |             110 |               1 |               4 |              69 |              44 |               0 |               0 |              47 |              38 |             455 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##           10 |             441 |             337 |              15 |               7 |             203 |             134 |               1 |               0 |              48 |              31 |            1217 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
## Column Total |            7349 |            4898 |             137 |              95 |            1347 |             880 |               7 |               4 |             507 |             406 |           15630 | 
## -------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
## 
## </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Other options - (table(A,B))</span>
<span class="co"># mycrosstab&lt;-table(nids$w1_a_m5, nids$race.gender)</span>
<span class="co"># mycrosstab #print table</span>
<span class="co"># </span>
<span class="co"># margin.table(mycrosstab, 1) # A frequencies (summed over B) </span>
<span class="co"># margin.table(mycrosstab, 2) # B frequencies (summed over A)</span>
<span class="co"># </span>
<span class="co"># round(prop.table(mycrosstab),3) # cell percentages</span>
<span class="co"># round(prop.table(mycrosstab, 1),3) # row percentages </span>
<span class="co"># round(prop.table(mycrosstab, 2),3) # column percentages</span></code></pre></div>
<p>There are many cells in this cross tab, so perhaps it is best if we try to <code>w1_a_m5&gt;0</code> to help us with our interpretation:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids_temp&lt;-nids <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(w1_a_m5<span class="op">&gt;</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(race))
<span class="kw">CrossTable</span>(nids_temp<span class="op">$</span>w1_a_m5, nids_temp<span class="op">$</span>race.gender, <span class="dt">expected =</span> <span class="ot">FALSE</span>,<span class="dt">prop.r =</span> <span class="ot">FALSE</span>, <span class="dt">prop.c =</span> <span class="ot">TRUE</span>, <span class="dt">prop.t =</span> <span class="ot">FALSE</span>,<span class="dt">prop.chisq =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Col Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  13781 
## 
##  
##                   | nids_temp$race.gender 
## nids_temp$w1_a_m5 |  African-Female |    African-Male |    Asian-Female |      Asian-Male | Coloured-Female |   Coloured-Male |    White-Female |      White-Male |       Row Total | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 1 |             568 |             370 |               3 |               4 |              29 |              27 |               3 |               2 |            1006 | 
##                   |           0.089 |           0.086 |           0.023 |           0.043 |           0.024 |           0.033 |           0.006 |           0.005 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 2 |             407 |             247 |               1 |               1 |              20 |              13 |               3 |               8 |             700 | 
##                   |           0.064 |           0.058 |           0.008 |           0.011 |           0.017 |           0.016 |           0.006 |           0.021 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 3 |             736 |             432 |               2 |               3 |              34 |              23 |               9 |               7 |            1246 | 
##                   |           0.115 |           0.101 |           0.015 |           0.032 |           0.029 |           0.028 |           0.018 |           0.018 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 4 |            1041 |             622 |               7 |               4 |             103 |              53 |              17 |              18 |            1865 | 
##                   |           0.163 |           0.145 |           0.053 |           0.043 |           0.087 |           0.066 |           0.035 |           0.046 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 5 |            1220 |             781 |              28 |              14 |             229 |             166 |              65 |              52 |            2555 | 
##                   |           0.191 |           0.182 |           0.211 |           0.151 |           0.193 |           0.205 |           0.133 |           0.134 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 6 |             805 |             599 |              13 |              12 |             146 |             117 |              58 |              52 |            1802 | 
##                   |           0.126 |           0.140 |           0.098 |           0.129 |           0.123 |           0.145 |           0.119 |           0.134 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 7 |             647 |             473 |              30 |              18 |             172 |             128 |              93 |              71 |            1632 | 
##                   |           0.101 |           0.110 |           0.226 |           0.194 |           0.145 |           0.158 |           0.190 |           0.183 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 8 |             387 |             315 |              33 |              26 |             183 |             104 |             146 |             110 |            1304 | 
##                   |           0.061 |           0.073 |           0.248 |           0.280 |           0.154 |           0.129 |           0.299 |           0.283 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                 9 |             142 |             110 |               1 |               4 |              69 |              44 |              47 |              38 |             455 | 
##                   |           0.022 |           0.026 |           0.008 |           0.043 |           0.058 |           0.054 |           0.096 |           0.098 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##                10 |             441 |             337 |              15 |               7 |             203 |             134 |              48 |              31 |            1216 | 
##                   |           0.069 |           0.079 |           0.113 |           0.075 |           0.171 |           0.166 |           0.098 |           0.080 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
##      Column Total |            6394 |            4286 |             133 |              93 |            1188 |             809 |             489 |             389 |           13781 | 
##                   |           0.464 |           0.311 |           0.010 |           0.007 |           0.086 |           0.059 |           0.035 |           0.028 |                 | 
## ------------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|-----------------|
## 
## </code></pre>
<p>This sets the non-response values of the satisfaction variable to missing and then generates the above table:</p>
<p>From this table we can see that there is not as much difference between the sexes within each race. However it appears that on average African adults have far lower satisfaction levels than the other racial groups, with White adults having the highest satisfaction levels.</p>
</div>
<div id="example-4-comparing-household-monthly-income-from-the-labour-market-to-individual-monthly-takehome-pay" class="section level2">
<h2><span class="header-section-number">6.7</span> Example 4: Comparing Household Monthly Income from the labour market to individual monthly takehome pay</h2>
<p>In the NIDS data set, the total monthly income of a household from the labour market was computed using a number of different rules. According to the metadata: “This variable is calculated by aggregating income from formal employment, casual labour, self-employment and income from helping friends with their business”. An interesting question then is: how different is the computed household labour-market monthly income (<code>w1_hhwag</code>) from the sum of the individual take-home pay (from primary employment) of every member in the household? Let’s examine this using the <code>dplyr</code> commands. To compute a variable that is the sum of all individual incomes (<code>w1_fwag</code>) for each member of a household, we can type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(hhid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">tot_fwag=</span><span class="kw">sum</span>(w1_fwag, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))</code></pre></div>
<p>Now, to test to see how different these two measures of income are all one has to do is list <code>hhid</code> <code>tot_fwag</code> and <code>w1_hhwage</code> together.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#subset to match extract from the Stata course</span>
<span class="kw">head</span>(<span class="kw">subset</span>(nids, <span class="dt">subset=</span>hhid<span class="op">&gt;=</span><span class="dv">101066</span>, <span class="dt">select=</span><span class="kw">c</span>(hhid,tot_fwag, w1_hhwage)), <span class="dt">n=</span>20L)</code></pre></div>
<pre><code>## # A tibble: 20 x 3
## # Groups:   hhid [6]
##      hhid tot_fwag w1_hhwage
##     &lt;int&gt;    &lt;dbl&gt;     &lt;dbl&gt;
##  1 101066     2500     2500 
##  2 101066     2500     2500 
##  3 101066     2500     2500 
##  4 101066     2500     2500 
##  5 101066     2500     2500 
##  6 101066     2500     2500 
##  7 101066     2500     2500 
##  8 101066     2500     2500 
##  9 101067     2400     2525 
## 10 101067     2400     2525 
## 11 101067     2400     2525 
## 12 101067     2400     2525 
## 13 101067     2400     2525 
## 14 101069        0      180 
## 15 101070        0      585.
## 16 101070        0      585.
## 17 101072        0       NA 
## 18 101072        0       NA 
## 19 101072        0       NA 
## 20 101073        0       NA</code></pre>
<p>In many cases, there are significant differences between the sum of a household’s individual take-home pay and household monthly income from the labour-market. In addition, there are many instances where entire households have not given a single value for individual take-home pay but there is a value for the household variable. There are two possible reasons for these differences: firstly, the individual level variable only gives income from the a person’s primary source of employment while the household variable uses aggregate income from various sources; secondly, in some cases income for the household income has been imputed based on various household characteristics.</p>
<p>One could also use the <strong>dplyr</strong> commands to compute other very useful variables. For example, one could compute the total number of children in a household for each household, or total number of births in the last year by province.</p>
<p>There are many useful ways to use <strong>dplyr</strong> <code>group_by</code>, and hopefully, these practice questions can assist you in gaining speed.</p>
<p><strong>6. Create a variable that is equal to one for exactly one member in every household.</strong></p>
<p>Question 6 Answer</p>
<p><strong>7. What is the total household income for the Kwa-Zulu Natal?</strong></p>
<p>Question 7 Answer</p>
</div>
<div id="chi-squared-testing-for-independence" class="section level2">
<h2><span class="header-section-number">6.8</span> Chi-Squared: testing for independence</h2>
<p>By now, we have examined tables of variables. Perhaps you have noticed that in a few examples as one variable increased or decreased, the other variable in the cross tab decreased or increased. While the naked eye is fairly good at noticing these relationships, it is unclear how accurate the relationships are until we examine them statistically. It is a good idea before any further analysis of the variables occurs to test whether the variables in the crosstab are independent or not. By independent, we mean whether as X moves one way or another, Y’s movements are completely random with respect to X. For instance, in children height is clearly not independent of age - older children are generally taller. In contrast, amongst 30 - 40 year olds, height is likely to be independent of age. As we shall see in the next chapter, testing for statistical independence is useful test to learn at this point. Note that this test for independence will test for any kind of functional relationship. However, in the next chapter, we will be working only with linear relationships.</p>
<p>Let’s try this simple example with the variables, <code>w1_a_h35</code> - “Respondent has driver’s license” and <code>w1_a_g4</code> -“Ownership of a motor vehicle (private) in running condition”. Basically, we are going to ask whether there is a relationship between these two variables - are people who have a driver’s license more likely to own a vehicle?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">$</span>dl&lt;-nids<span class="op">$</span>w1_a_h35
nids<span class="op">$</span>dl[nids<span class="op">$</span>w1_a_h35<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span>

nids<span class="op">$</span>mv&lt;-nids<span class="op">$</span>w1_a_g4
nids<span class="op">$</span>mv[nids<span class="op">$</span>w1_a_g4<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span>

nids<span class="op">$</span>mv&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>mv, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Yes&quot;</span>,<span class="st">&quot;No&quot;</span>))
nids<span class="op">$</span>dl&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>dl, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Yes&quot;</span>,<span class="st">&quot;No&quot;</span>))

<span class="kw">CrossTable</span>(nids<span class="op">$</span>dl, nids<span class="op">$</span>mv, <span class="dt">digits=</span><span class="dv">3</span>, <span class="dt">max.width =</span> <span class="dv">5</span>, <span class="dt">expected=</span><span class="ot">FALSE</span>, <span class="dt">prop.r=</span><span class="ot">TRUE</span>, <span class="dt">prop.c=</span><span class="ot">TRUE</span>,<span class="dt">prop.t=</span><span class="ot">FALSE</span>, <span class="dt">prop.chisq=</span><span class="ot">TRUE</span>, <span class="dt">chisq =</span> <span class="ot">TRUE</span>, <span class="dt">missing.include=</span><span class="ot">FALSE</span>,<span class="dt">format=</span><span class="kw">c</span>(<span class="st">&quot;SAS&quot;</span>,<span class="st">&quot;SPSS&quot;</span>))</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## | Chi-square contribution |
## |           N / Row Total |
## |           N / Col Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  15522 
## 
##  
##              | nids$mv 
##      nids$dl |       Yes |        No | Row Total | 
## -------------|-----------|-----------|-----------|
##          Yes |      1204 |      1082 |      2286 | 
##              |  4657.895 |   474.850 |           | 
##              |     0.527 |     0.473 |     0.147 | 
##              |     0.838 |     0.077 |           | 
## -------------|-----------|-----------|-----------|
##           No |       232 |     13004 |     13236 | 
##              |   804.469 |    82.012 |           | 
##              |     0.018 |     0.982 |     0.853 | 
##              |     0.162 |     0.923 |           | 
## -------------|-----------|-----------|-----------|
## Column Total |      1436 |     14086 |     15522 | 
##              |     0.093 |     0.907 |           | 
## -------------|-----------|-----------|-----------|
## 
##  
## Statistics for All Table Factors
## 
## 
## Pearson&#39;s Chi-squared test 
## ------------------------------------------------------------
## Chi^2 =  6019.226     d.f. =  1     p =  0 
## 
## Pearson&#39;s Chi-squared test with Yates&#39; continuity correction 
## ------------------------------------------------------------
## Chi^2 =  6013.163     d.f. =  1     p =  0 
## 
## </code></pre>
<p>First of all, notice that we have specified both the <code>row</code> (<code>prop.r=TRUE</code>) and <code>column</code> (<code>prop.c=TRUE</code>) options and therefore R gives percentages adding across rows (3rd entry in every cell) and percentages adding up down columns (4th entry in every cell). Secondly, since we also specified the <code>chisq = TRUE</code> option, we see that at the bottom of the table, R reports a chi2 value as well as a p-value. The p=0.000 tells us that the two variables are related (i.e. that the probability that they are not related is 0.000). Logically, this makes sense. We expect that people who own a private motor to have a license (i.e. we expect that a person’s license status will be related to their car ownership status). Particularly, from the table we can see that 83.8% of those who own a car have a driver’s license.</p>
</div>
<div id="cross-tabs-and-hypothesis-testing-chi2-examples-the-comparative-level-of-happiness-variable" class="section level2">
<h2><span class="header-section-number">6.9</span> Cross-tabs and hypothesis testing (Chi^2) examples: The comparative level of happiness variable</h2>
<div id="example-1-comparative-happiness-and-employment-status" class="section level3">
<h3><span class="header-section-number">6.9.1</span> Example 1: Comparative happiness and employment status</h3>
<p>Now that we have learned to perform basic and more advanced cross-tabulations, we might find it beneficial to apply some of this new knowledge to one of the more interesting variables in the data set: the “level of happiness in comparison to 10 years ago” variable, <code>w1_a_m6</code>. The 2008 survey asked adults if they were “happier, the same or less happy with life than they were 10 years ago”, with these responses being coded as 1, 2, and 3, respectively. Before tabulating the <code>w1_a_m6</code> variable with any of the other variables in our set, we might want to tabulate it on its own in order to get a better feel for it.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">table</span>(nids<span class="op">$</span>w1_a_m6)</code></pre></div>
<pre><code>## 
##   -8   -3    1    2    3    9 
##    9  110 6358 4984 3806  368</code></pre>
<p>What does the value of 9 represent? This is a typical example of why it is VERY important to look closely at the variables you are working with. Even though throughout almost all of the NIDS dataset, a -9 is used to represent a “don’t know” response, here a 9 is used. This is likely to be due to an error made at some point in the data capturing or data cleaning process as the other non-responses have taken on negative values. Also note that there are not a huge number of non-respondents so that these categories have little influence on the total percentage. This may not always be the case. For example if a large number of people had refused to respond this would have affected the distribution of percentages across all categories. Also, we might be more worried about people who “refused” than those who said “don’t know” as they might all have refused since they are all unhappy, but don’t want to say so. But luckily there are only 9 refused and only about 3% non-responses in total.</p>
<p>Although this simple univariate tabulation is certainly educational, we can learn more by analyzing this variable against another, i.e., performing a bivariate analysis. Say, for instance, that we wanted to know how one’s happiness compared to ten years ago varied with current employment status. In order to find this out, we would cross-tabulate <code>w1_a_m6</code> with <code>w1_a_e1</code> (coded as 1 for “currently employed” and 2 for “not currently employed”). Here we might wish to ignore the non-responses using qualifiers to obtain more readily interpretable results. We may start by generating new variables that cleans the types of non-responses.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">$</span>lh&lt;-nids<span class="op">$</span>w1_a_m6
nids<span class="op">$</span>lh[nids<span class="op">$</span>w1_a_m6<span class="op">&lt;</span><span class="dv">0</span> <span class="op">|</span><span class="st"> </span>nids<span class="op">$</span>w1_a_m6<span class="op">&gt;</span><span class="dv">3</span>]&lt;-<span class="ot">NA</span>

nids<span class="op">$</span>es&lt;-nids<span class="op">$</span>w1_a_e1
nids<span class="op">$</span>es[nids<span class="op">$</span>w1_a_e1<span class="op">&lt;</span><span class="dv">0</span>]&lt;-<span class="ot">NA</span>

nids<span class="op">$</span>lh&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>lh, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Happier&quot;</span>,<span class="st">&quot;The same&quot;</span>, <span class="st">&quot;Less happy&quot;</span>))
nids<span class="op">$</span>es&lt;-<span class="kw">factor</span>(nids<span class="op">$</span>es, <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Yes&quot;</span>,<span class="st">&quot;No&quot;</span>))

<span class="kw">CrossTable</span>(nids<span class="op">$</span>lh, nids<span class="op">$</span>es, <span class="dt">digits=</span><span class="dv">4</span>, <span class="dt">max.width =</span> <span class="dv">5</span>, <span class="dt">expected=</span><span class="ot">FALSE</span>, <span class="dt">prop.r=</span><span class="ot">TRUE</span>, <span class="dt">prop.c=</span><span class="ot">TRUE</span>, <span class="dt">prop.t=</span><span class="ot">TRUE</span>, <span class="dt">prop.chisq=</span><span class="ot">TRUE</span>, <span class="dt">chisq =</span> <span class="ot">TRUE</span>, <span class="dt">missing.include=</span><span class="ot">FALSE</span>,<span class="dt">format=</span><span class="kw">c</span>(<span class="st">&quot;SAS&quot;</span>))</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## | Chi-square contribution |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  15144 
## 
##  
##              | nids$es 
##      nids$lh |       Yes |        No | Row Total | 
## -------------|-----------|-----------|-----------|
##      Happier |      1985 |      4371 |      6356 | 
##              |  110.1326 |   36.1057 |           | 
##              |    0.3123 |    0.6877 |    0.4197 | 
##              |    0.5309 |    0.3833 |           | 
##              |    0.1311 |    0.2886 |           | 
## -------------|-----------|-----------|-----------|
##     The same |      1084 |      3898 |      4982 | 
##              |   17.3386 |    5.6843 |           | 
##              |    0.2176 |    0.7824 |    0.3290 | 
##              |    0.2899 |    0.3418 |           | 
##              |    0.0716 |    0.2574 |           | 
## -------------|-----------|-----------|-----------|
##   Less happy |       670 |      3136 |      3806 | 
##              |   77.3997 |   25.3746 |           | 
##              |    0.1760 |    0.8240 |    0.2513 | 
##              |    0.1792 |    0.2750 |           | 
##              |    0.0442 |    0.2071 |           | 
## -------------|-----------|-----------|-----------|
## Column Total |      3739 |     11405 |     15144 | 
##              |    0.2469 |    0.7531 |           | 
## -------------|-----------|-----------|-----------|
## 
##  
## Statistics for All Table Factors
## 
## 
## Pearson&#39;s Chi-squared test 
## ------------------------------------------------------------
## Chi^2 =  272.0355     d.f. =  2     p =  8.476959e-60 
## 
## 
## </code></pre>
<p>Now we can say that of those who are employed 53% are happier than 10 years ago while only 38% of those who are unemployed are happier than 10 years ago. A less useful interpretation in this case would be to look across the first row and say that of those who are happier than they were ten years ago, 31% are employed and 69% are not employed. Does this make sense? Make sure you understand what is going on here. The clue for these seemingly strange results is the large difference between the number of unemployed (11 405) and employed (3 739) individuals.</p>
</div>
<div id="example-2-comparative-happiness-by-province" class="section level3">
<h3><span class="header-section-number">6.9.2</span> Example 2: Comparative happiness by province</h3>
<p>Let’s try another example. For instance, a cross-tabulation of <code>w1_hhprov</code> on <code>w1_a_m6</code> (ignoring nonresponses) generates a table crammed with raw numbers. Using the <code>prop.r=TRUE</code> option with this same cross-tabulation yields a more decipherable result.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">w1_hhprov =</span> <span class="kw">factor</span>(w1_hhprov, <span class="dt">levels=</span><span class="dv">1</span><span class="op">:</span><span class="dv">9</span>, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;Western Cape&quot;</span>,<span class="st">&quot;Eastern Cape&quot;</span>,<span class="st">&quot;Northern Cape&quot;</span>,<span class="st">&quot;Free State&quot;</span>,<span class="st">&quot;KwaZulu-Natal&quot;</span>,<span class="st">&quot;North West&quot;</span>,<span class="st">&quot;Gauteng&quot;</span>,<span class="st">&quot;Mpumalanga&quot;</span>,<span class="st">&quot;Limpopo&quot;</span>)))

<span class="kw">CrossTable</span>(nids<span class="op">$</span>w1_hhprov, nids<span class="op">$</span>lh, <span class="dt">digits=</span><span class="dv">4</span>, <span class="dt">max.width =</span> <span class="dv">6</span>, <span class="dt">expected=</span><span class="ot">FALSE</span>, <span class="dt">prop.r=</span><span class="ot">TRUE</span>, <span class="dt">prop.c=</span><span class="ot">FALSE</span>, <span class="dt">prop.t=</span><span class="ot">FALSE</span>, <span class="dt">prop.chisq=</span><span class="ot">FALSE</span>, <span class="dt">chisq =</span> <span class="ot">FALSE</span>, <span class="dt">missing.include=</span><span class="ot">FALSE</span>,<span class="dt">format=</span><span class="kw">c</span>(<span class="st">&quot;SAS&quot;</span>,<span class="st">&quot;SPSS&quot;</span>))</code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Row Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  15148 
## 
##  
##                | nids$lh 
## nids$w1_hhprov |    Happier |   The same | Less happy |  Row Total | 
## ---------------|------------|------------|------------|------------|
##   Western Cape |       1007 |        610 |        300 |       1917 | 
##                |     0.5253 |     0.3182 |     0.1565 |     0.1266 | 
## ---------------|------------|------------|------------|------------|
##   Eastern Cape |        729 |        623 |        603 |       1955 | 
##                |     0.3729 |     0.3187 |     0.3084 |     0.1291 | 
## ---------------|------------|------------|------------|------------|
##  Northern Cape |        696 |        207 |        154 |       1057 | 
##                |     0.6585 |     0.1958 |     0.1457 |     0.0698 | 
## ---------------|------------|------------|------------|------------|
##     Free State |        427 |        284 |        219 |        930 | 
##                |     0.4591 |     0.3054 |     0.2355 |     0.0614 | 
## ---------------|------------|------------|------------|------------|
##  KwaZulu-Natal |       1246 |       1311 |       1362 |       3919 | 
##                |     0.3179 |     0.3345 |     0.3475 |     0.2587 | 
## ---------------|------------|------------|------------|------------|
##     North West |        496 |        464 |        354 |       1314 | 
##                |     0.3775 |     0.3531 |     0.2694 |     0.0867 | 
## ---------------|------------|------------|------------|------------|
##        Gauteng |        801 |        466 |        286 |       1553 | 
##                |     0.5158 |     0.3001 |     0.1842 |     0.1025 | 
## ---------------|------------|------------|------------|------------|
##     Mpumalanga |        496 |        295 |        234 |       1025 | 
##                |     0.4839 |     0.2878 |     0.2283 |     0.0677 | 
## ---------------|------------|------------|------------|------------|
##        Limpopo |        460 |        724 |        294 |       1478 | 
##                |     0.3112 |     0.4899 |     0.1989 |     0.0976 | 
## ---------------|------------|------------|------------|------------|
##   Column Total |       6358 |       4984 |       3806 |      15148 | 
## ---------------|------------|------------|------------|------------|
## 
## </code></pre>
<p>Without the benefit of row percentages, we would see that 1362 people in KwaZulu-Natal feel less happy than 10 years ago, for example. The row percentage puts this number in the context of the total number of respondents in KwaZulu-Natal, thus telling us that these 1362 people comprise about 34.75% of the respondents residing in KwaZulu-Natal. What percentage of the total sample is this?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CrossTable</span>(nids<span class="op">$</span>w1_hhprov, nids<span class="op">$</span>lh)    <span class="co">#Will give you all stats</span></code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## | Chi-square contribution |
## |           N / Row Total |
## |           N / Col Total |
## |         N / Table Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  15148 
## 
##  
##                | nids$lh 
## nids$w1_hhprov |    Happier |   The same | Less happy |  Row Total | 
## ---------------|------------|------------|------------|------------|
##   Western Cape |       1007 |        610 |        300 |       1917 | 
##                |     50.907 |      0.681 |     68.510 |            | 
##                |      0.525 |      0.318 |      0.156 |      0.127 | 
##                |      0.158 |      0.122 |      0.079 |            | 
##                |      0.066 |      0.040 |      0.020 |            | 
## ---------------|------------|------------|------------|------------|
##   Eastern Cape |        729 |        623 |        603 |       1955 | 
##                |     10.217 |      0.637 |     25.445 |            | 
##                |      0.373 |      0.319 |      0.308 |      0.129 | 
##                |      0.115 |      0.125 |      0.158 |            | 
##                |      0.048 |      0.041 |      0.040 |            | 
## ---------------|------------|------------|------------|------------|
##  Northern Cape |        696 |        207 |        154 |       1057 | 
##                |    143.538 |     56.984 |     46.876 |            | 
##                |      0.658 |      0.196 |      0.146 |      0.070 | 
##                |      0.109 |      0.042 |      0.040 |            | 
##                |      0.046 |      0.014 |      0.010 |            | 
## ---------------|------------|------------|------------|------------|
##     Free State |        427 |        284 |        219 |        930 | 
##                |      3.442 |      1.580 |      0.921 |            | 
##                |      0.459 |      0.305 |      0.235 |      0.061 | 
##                |      0.067 |      0.057 |      0.058 |            | 
##                |      0.028 |      0.019 |      0.014 |            | 
## ---------------|------------|------------|------------|------------|
##  KwaZulu-Natal |       1246 |       1311 |       1362 |       3919 | 
##                |     96.738 |      0.361 |    144.599 |            | 
##                |      0.318 |      0.335 |      0.348 |      0.259 | 
##                |      0.196 |      0.263 |      0.358 |            | 
##                |      0.082 |      0.087 |      0.090 |            | 
## ---------------|------------|------------|------------|------------|
##     North West |        496 |        464 |        354 |       1314 | 
##                |      5.589 |      2.320 |      1.723 |            | 
##                |      0.377 |      0.353 |      0.269 |      0.087 | 
##                |      0.078 |      0.093 |      0.093 |            | 
##                |      0.033 |      0.031 |      0.023 |            | 
## ---------------|------------|------------|------------|------------|
##        Gauteng |        801 |        466 |        286 |       1553 | 
##                |     34.135 |      3.958 |     27.825 |            | 
##                |      0.516 |      0.300 |      0.184 |      0.103 | 
##                |      0.126 |      0.093 |      0.075 |            | 
##                |      0.053 |      0.031 |      0.019 |            | 
## ---------------|------------|------------|------------|------------|
##     Mpumalanga |        496 |        295 |        234 |       1025 | 
##                |     10.058 |      5.292 |      2.151 |            | 
##                |      0.484 |      0.288 |      0.228 |      0.068 | 
##                |      0.078 |      0.059 |      0.061 |            | 
##                |      0.033 |      0.019 |      0.015 |            | 
## ---------------|------------|------------|------------|------------|
##        Limpopo |        460 |        724 |        294 |       1478 | 
##                |     41.450 |    116.196 |     16.113 |            | 
##                |      0.311 |      0.490 |      0.199 |      0.098 | 
##                |      0.072 |      0.145 |      0.077 |            | 
##                |      0.030 |      0.048 |      0.019 |            | 
## ---------------|------------|------------|------------|------------|
##   Column Total |       6358 |       4984 |       3806 |      15148 | 
##                |      0.420 |      0.329 |      0.251 |            | 
## ---------------|------------|------------|------------|------------|
## 
## </code></pre>
<p>Thus we see a table revealing that the 1362 people living in KwaZulu-Natal and feeling less happy than 10 years ago account for 9% of all individuals responding to this item of the survey.</p>
</div>
<div id="example-3-comparative-happiness-and-household-income" class="section level3">
<h3><span class="header-section-number">6.9.3</span> Example 3: Comparative happiness and household income</h3>
<p>Thus far, we have only been tabulating the <code>w1_a_m6</code> variable with other categorical variables. What if we wanted to find out how people’s comparative happiness varied with a continuous variable like total household income, for example? Notice that in this example, even though one of the variables we are using is a household level variable, we don’t use <code>hhrestrict</code>. This is because we are asking: is there a relationship between an individual’s happiness in comparison to ten years ago and that individual’s household income? It is an individual level question.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(lh)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(w1_hhincome, <span class="dt">na.rm=</span>T), <span class="dt">sd =</span> <span class="kw">sd</span>(w1_hhincome, <span class="dt">na.rm=</span>T), <span class="dt">n=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">na.omit</span>()</code></pre></div>
<pre><code>## # A tibble: 3 x 4
##   lh          mean    sd     n
##   &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;
## 1 Happier    6074. 9495.  6358
## 2 The same   3942. 6840.  4984
## 3 Less happy 3447. 6301.  3806</code></pre>
<p>Eliminating non-responses, we thus find that on average, adults in this survey who feel happier than ten years ago belong to a household with a lower average income than the respondents who felt the same or less happy. This analysis could also be done by province:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">happiness&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">rename</span>(<span class="dt">level_happiness=</span>lh) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(level_happiness, province)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mean =</span> <span class="kw">mean</span>(w1_hhincome, <span class="dt">na.rm=</span>T), <span class="dt">sd =</span> <span class="kw">sd</span>(w1_hhincome, <span class="dt">na.rm=</span>T), <span class="dt">n=</span><span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">na.omit</span>()</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">knitr<span class="op">::</span><span class="kw">kable</span>(
  <span class="kw">head</span>(happiness, <span class="dv">27</span>), <span class="dt">booktabs =</span> <span class="ot">TRUE</span>,
  <span class="dt">caption =</span> <span class="st">&#39;Summary level of happiness by province and household income&#39;</span>
)</code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-44">Table 6.1: </span>Summary level of happiness by province and household income</caption>
<thead>
<tr class="header">
<th align="left">level_happiness</th>
<th align="left">province</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Happier</td>
<td align="left">Western Cape</td>
<td align="right">8015.570</td>
<td align="right">10469.686</td>
<td align="right">1007</td>
</tr>
<tr class="even">
<td align="left">Happier</td>
<td align="left">Eastern Cape</td>
<td align="right">3972.763</td>
<td align="right">6020.442</td>
<td align="right">729</td>
</tr>
<tr class="odd">
<td align="left">Happier</td>
<td align="left">Northern Cape</td>
<td align="right">5302.639</td>
<td align="right">6034.517</td>
<td align="right">696</td>
</tr>
<tr class="even">
<td align="left">Happier</td>
<td align="left">Free State</td>
<td align="right">4457.535</td>
<td align="right">6128.849</td>
<td align="right">427</td>
</tr>
<tr class="odd">
<td align="left">Happier</td>
<td align="left">KwaZulu-Natal</td>
<td align="right">4204.751</td>
<td align="right">6638.604</td>
<td align="right">1246</td>
</tr>
<tr class="even">
<td align="left">Happier</td>
<td align="left">North West</td>
<td align="right">5667.018</td>
<td align="right">10555.289</td>
<td align="right">496</td>
</tr>
<tr class="odd">
<td align="left">Happier</td>
<td align="left">Gauteng</td>
<td align="right">10785.584</td>
<td align="right">14600.511</td>
<td align="right">801</td>
</tr>
<tr class="even">
<td align="left">Happier</td>
<td align="left">Mpumalanga</td>
<td align="right">6607.049</td>
<td align="right">9278.622</td>
<td align="right">496</td>
</tr>
<tr class="odd">
<td align="left">Happier</td>
<td align="left">Limpopo</td>
<td align="right">4550.641</td>
<td align="right">9334.493</td>
<td align="right">460</td>
</tr>
<tr class="even">
<td align="left">The same</td>
<td align="left">Western Cape</td>
<td align="right">6598.891</td>
<td align="right">8651.250</td>
<td align="right">610</td>
</tr>
<tr class="odd">
<td align="left">The same</td>
<td align="left">Eastern Cape</td>
<td align="right">2680.517</td>
<td align="right">4296.637</td>
<td align="right">623</td>
</tr>
<tr class="even">
<td align="left">The same</td>
<td align="left">Northern Cape</td>
<td align="right">5183.479</td>
<td align="right">7247.052</td>
<td align="right">207</td>
</tr>
<tr class="odd">
<td align="left">The same</td>
<td align="left">Free State</td>
<td align="right">3761.236</td>
<td align="right">5190.223</td>
<td align="right">284</td>
</tr>
<tr class="even">
<td align="left">The same</td>
<td align="left">KwaZulu-Natal</td>
<td align="right">2906.890</td>
<td align="right">4177.492</td>
<td align="right">1311</td>
</tr>
<tr class="odd">
<td align="left">The same</td>
<td align="left">North West</td>
<td align="right">3470.998</td>
<td align="right">6215.211</td>
<td align="right">464</td>
</tr>
<tr class="even">
<td align="left">The same</td>
<td align="left">Gauteng</td>
<td align="right">5911.095</td>
<td align="right">10162.332</td>
<td align="right">466</td>
</tr>
<tr class="odd">
<td align="left">The same</td>
<td align="left">Mpumalanga</td>
<td align="right">4976.882</td>
<td align="right">10330.690</td>
<td align="right">295</td>
</tr>
<tr class="even">
<td align="left">The same</td>
<td align="left">Limpopo</td>
<td align="right">2989.421</td>
<td align="right">6172.425</td>
<td align="right">724</td>
</tr>
<tr class="odd">
<td align="left">Less happy</td>
<td align="left">Western Cape</td>
<td align="right">6028.609</td>
<td align="right">7747.007</td>
<td align="right">300</td>
</tr>
<tr class="even">
<td align="left">Less happy</td>
<td align="left">Eastern Cape</td>
<td align="right">1858.170</td>
<td align="right">2178.584</td>
<td align="right">603</td>
</tr>
<tr class="odd">
<td align="left">Less happy</td>
<td align="left">Northern Cape</td>
<td align="right">6387.000</td>
<td align="right">9644.741</td>
<td align="right">154</td>
</tr>
<tr class="even">
<td align="left">Less happy</td>
<td align="left">Free State</td>
<td align="right">3251.774</td>
<td align="right">7325.622</td>
<td align="right">219</td>
</tr>
<tr class="odd">
<td align="left">Less happy</td>
<td align="left">KwaZulu-Natal</td>
<td align="right">2903.290</td>
<td align="right">4852.305</td>
<td align="right">1362</td>
</tr>
<tr class="even">
<td align="left">Less happy</td>
<td align="left">North West</td>
<td align="right">3674.960</td>
<td align="right">6183.364</td>
<td align="right">354</td>
</tr>
<tr class="odd">
<td align="left">Less happy</td>
<td align="left">Gauteng</td>
<td align="right">4871.022</td>
<td align="right">9635.023</td>
<td align="right">286</td>
</tr>
<tr class="even">
<td align="left">Less happy</td>
<td align="left">Mpumalanga</td>
<td align="right">4377.594</td>
<td align="right">8708.411</td>
<td align="right">234</td>
</tr>
<tr class="odd">
<td align="left">Less happy</td>
<td align="left">Limpopo</td>
<td align="right">2790.755</td>
<td align="right">5379.583</td>
<td align="right">294</td>
</tr>
</tbody>
</table>
<p>We see that difference in average household income according to relative happiness is more pronounced in Gauteng than in the country as a whole. The individuals who reported that they are happier than ten years ago have an average monthly income of over R10 000!</p>
</div>
<div id="example-4-comparative-happiness-and-geo-type" class="section level3">
<h3><span class="header-section-number">6.9.4</span> Example 4: Comparative happiness and geo-type</h3>
<p>Finally, although our cross-tabulations might suggest that there is a relationship between two variables, the results from the survey might not be statistically significant (note that this section is optional for those unfamiliar with hypothesis testing). Say for instance that we run a bivariate analysis on the two variables: <code>w1_a_m6</code> (comparative happiness) and <code>w1_hhgeo</code> (geo-type).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">CrossTable</span>(nids<span class="op">$</span>lh, nids<span class="op">$</span>w1_hhgeo, <span class="dt">digits=</span><span class="dv">4</span>, <span class="dt">max.width =</span> <span class="dv">5</span>, <span class="dt">expected=</span><span class="ot">FALSE</span>, <span class="dt">prop.c=</span><span class="ot">TRUE</span>, <span class="dt">prop.r=</span><span class="ot">FALSE</span>, <span class="dt">prop.t=</span><span class="ot">FALSE</span>, <span class="dt">prop.chisq=</span><span class="ot">FALSE</span>, <span class="dt">chisq =</span> <span class="ot">TRUE</span>, <span class="dt">missing.include=</span><span class="ot">FALSE</span>)    <span class="co">#Will give you all stats</span></code></pre></div>
<pre><code>## 
##  
##    Cell Contents
## |-------------------------|
## |                       N |
## |           N / Col Total |
## |-------------------------|
## 
##  
## Total Observations in Table:  15148 
## 
##  
##              | nids$w1_hhgeo 
##      nids$lh |           Rural formal | Tribal authority areas |           Urban formal |         Urban informal |              Row Total | 
## -------------|------------------------|------------------------|------------------------|------------------------|------------------------|
##      Happier |                    683 |                   1974 |                   3283 |                    418 |                   6358 | 
##              |                 0.4290 |                 0.3207 |                 0.5118 |                 0.4239 |                        | 
## -------------|------------------------|------------------------|------------------------|------------------------|------------------------|
##     The same |                    553 |                   2350 |                   1790 |                    291 |                   4984 | 
##              |                 0.3474 |                 0.3818 |                 0.2790 |                 0.2951 |                        | 
## -------------|------------------------|------------------------|------------------------|------------------------|------------------------|
##   Less happy |                    356 |                   1831 |                   1342 |                    277 |                   3806 | 
##              |                 0.2236 |                 0.2975 |                 0.2092 |                 0.2809 |                        | 
## -------------|------------------------|------------------------|------------------------|------------------------|------------------------|
## Column Total |                   1592 |                   6155 |                   6415 |                    986 |                  15148 | 
##              |                 0.1051 |                 0.4063 |                 0.4235 |                 0.0651 |                        | 
## -------------|------------------------|------------------------|------------------------|------------------------|------------------------|
## 
##  
## Statistics for All Table Factors
## 
## 
## Pearson&#39;s Chi-squared test 
## ------------------------------------------------------------
## Chi^2 =  485.3229     d.f. =  6     p =  1.219035e-101 
## 
## 
## </code></pre>
<p>We can see in our table that effectively 51% of Urban Formal respondents felt happier than ten years ago while about 21% of Urban formal adult respondents felt less happy than 10 years ago. While the majority of respondents in Urban Formal Areas seem happier than 10 years, this isn’t the case in tribal authority areas. Here 32% of respondents felt happier than 10 years ago while 68% were the same or less happy. The question then arises: can we conclude that the difference in feelings of comparative happiness according to location that appears in our sample overstates the difference that exists in the population, i.e. are our results statistically significant? We would set up the null (H0) and alternative (H1) hypotheses like this:</p>
<p><strong>H0: No significant relationship exists between <code>w1_a_m6</code> and <code>w1_hhgeo</code>.</strong></p>
<p><strong>H1: A significant relationship exists between <code>w1_a_m6</code> and <code>w1_hhgeo</code>.</strong></p>
<p>R can test this for us while simultaneously performing our cross-tabulation requests. As we have seen above, this test is known as the chi square test and it determines whether or not a relationship exists between two categorical variables.</p>
<p>The chi2 option gives this line of output underneath the cross-tabulation results table. The most important element of the line is “p” The “p” value gives the probability that the null hypothesis (H0) is true and the two variables are statistically independent. The p-value is significant and we can thus conclude that comparative happiness did in fact differ according to metropolitan location. A possible interpretation of this relationship is that those in more rural areas have been disappointed by the lack of improvement in service delivery as promised by the government in 1994.</p>
</div>
</div>
<div id="worked-example-assessing-the-impact-of-per-capita-income-on-bmi" class="section level2">
<h2><span class="header-section-number">6.10</span> Worked Example: Assessing the impact of per capita income on BMI</h2>
<p>In this worked example we aim to assess how BMI varies with income. Are rich people more likely to be obese than people with lower incomes? They have more money to spend on food, but can also afford a healthy diet and to buy gym memberships. By now we are reasonably well acquainted with the BMI variable, but we need to find a variable which gives us an indication of how rich (well-off) the person is.</p>
<p>With such a wide variety of income variables, we need to decide which one will be the most appropriate to investigate the relationship between BMI and income. Should we use the amount of income that an individual earns or the total income of the household?</p>
<p>Individual income does not take into consideration that families generally pool/share their income. Individual income would assign all people who do not work, receive grants or transfers, zero income. This is not what we want; we need a variable which reflects the level of resources available to the individual. Total household income (<code>w1_hhincome</code>) would give an indication of the wealth of the household, but we need to take into consideration the number of household members who will share this income.</p>
<p>We could just divide the total household income by the household size variable to create a per capita household income variable. But it may be more accurate to weight children less than adults since they generally consume a smaller proportion of household resources (and hence household income) than adults. For example, consider two households each with a total monthly income of R2 000, but one household consists of four adults and the other of two adults and two young children. If we assume for simplicity that all income is spent on food, we would expect that the adults in the household consisting of two adults and two children will have access to more food than the adults in the four adult household.</p>
<p>Let’s assume that children under 15 use half the household resources used by those 15 years or older. We therefore need to calculate the number of household members under 15 and the number of members over 15 in the household. To do this, we create a variable that assigns to every member of the household, a value equal to the number of children under the age of 15 in the household.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids<span class="op">$</span>child.dummy&lt;-<span class="dv">0</span>
nids<span class="op">$</span>child.dummy[nids<span class="op">$</span>w1_quest_typ <span class="op">==</span><span class="st"> </span><span class="dv">2</span>]&lt;-<span class="dv">1</span></code></pre></div>
<p>The code above creates a variable that assigns to every member of the household, the number of individuals over the age of 15. However, it is worth noticing that we used the questionnaire type answered by the individual as an indicator for their age as individuals under 15 were meant to answer the child questionnaire, while those over 15 were meant to have an adult or proxy questionnaire. However, there are several borderline cases (around 15 years old) which answered the wrong questionnaire. This isn’t too worrying for us in this instance though.</p>
<p>Let’s generate a variable that contains the number of adults in a household.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids1&lt;-nids<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(hhid, pid, w1_hhsizer, w1_hhincome, child.dummy, bmi, gender,bmi_valid)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hh.children=</span><span class="kw">sum</span>(child.dummy, <span class="dt">na.rm=</span><span class="ot">TRUE</span>))<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hh.adults =</span> w1_hhsizer<span class="op">-</span><span class="st"> </span>hh.children)</code></pre></div>
<p>Check to see that the variables give us the number of children and adults in the household.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(nids1)</code></pre></div>
<pre><code>## # A tibble: 6 x 10
## # Groups:   hhid [2]
##     hhid    pid w1_hhsizer w1_hhincome child.dummy   bmi gender bmi_valid
##    &lt;int&gt;  &lt;int&gt;      &lt;int&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;      &lt;dbl&gt;
## 1 101012 314585          1       1045.           0  30.9 Female         1
## 2 101013 314544          5        588.           0  19.3 Male           1
## 3 101013 314550          5        588.           0  23.1 Female         1
## 4 101013 406295          5        588.           1  NA   Female        NA
## 5 101013 406296          5        588.           1  NA   Male          NA
## 6 101013 406297          5        588.           1  NA   Female        NA
## # ... with 2 more variables: hh.children &lt;dbl&gt;, hh.adults &lt;dbl&gt;</code></pre>
<p>Now we can create our adult equivalent household size variable, where children count 0.5 of the amount that adults do. While this is crude, it is sufficient for our purposes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids1&lt;-nids1<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hhsize.adultequiv=</span>hh.adults <span class="op">+</span><span class="st"> </span><span class="fl">0.5</span><span class="op">*</span>hh.children)</code></pre></div>
<p>Finally create the household per capita adult equivalent income variable. While this sounds complicated, this is just a variable that gives us per capita income in every household, adjusting for the number of children in the household. It is a household level per capita income variable.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids1&lt;-nids1<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hh.pcinc=</span>w1_hhincome<span class="op">/</span>hhsize.adultequiv)</code></pre></div>
<p>Notice that the <code>hh.pcinc</code> column is simply equal to the <code>w1_hhincome</code> column divided by the <code>hhsize.adultequiv</code> column. We now have an income variable which reflects the household income available to each individual and can proceed to assess the impact of financial wellbeing on BMI.</p>
<p>Recall that when we are dealing with BMI, we want to restrict our sample to adults over 20, but since we have calculated our BMI variable in such a way that it only has values for people over the age of 20, we will often not need to restrict our sample explicitly. We should however always be careful that we are indeed only working with a sample that includes individuals over the age of 20.</p>
<p>Since BMI and income are both continuous variables it is easiest to summarize the relationship between them using a scatter graph.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(nids1, <span class="kw">aes</span>(hh.pcinc, bmi)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">labs</span>(<span class="dt">x=</span><span class="st">&quot;House per capita income&quot;</span>,<span class="dt">y=</span><span class="st">&quot;Respondent&#39;s Body Mass Index&quot;</span>, <span class="dt">title=</span><span class="st">&quot;Scatterplot of BMI and pc hh_income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
<pre><code>## Warning: Removed 19885 rows containing missing values (geom_point).</code></pre>
<p><img src="06-bivariate_analysis_files/figure-html/unnamed-chunk-51-1.png" width="672" /></p>
<p>It is clear from the scatterplot that there are very large outliers on both dimensions (income and BMI). While the majority of the sample has BMI values below 100 and <code>hh.pcinc</code> values under 30000, there are a few extremely large BMI and income values. Do you think it is possible for someone to have a BMI of over 150? What height and weight combination would such an individual need to have? Check to see how tall and heavy the individuals with BMI greater than 150 in the sample are. While, these may be possible combinations, it seems more likely that at least some of them are errors.</p>
<p>In order to make the graph more useful, we should restrict the range of both BMI and income. Here, we will use the range [15, 50] for BMI as we did previously and [0, 14 000] for income, since 99% of the sample falls below this income level. Check this.</p>
<p>Redraw the scatterplot restricting the range of BMI and income as suggested and adding a trend line.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(nids1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(bmi_valid <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>hh.pcinc <span class="op">&lt;</span><span class="st"> </span><span class="dv">13000</span>), <span class="kw">aes</span>(hh.pcinc, bmi)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><img src="06-bivariate_analysis_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<p>This graph is much clearer than the previous one. What can we say about the relationship between BMI and income from this graph?</p>
<p>The graph shows that the relationship between BMI and income is positive. As income increases, BMI increases. We see that at low income levels there are far more observations than at higher income levels and that the scatter is also more dispersed.</p>
<p>Recall that there are stark differences in mean BMI between men and women. In light of this, alter the graph to give a more complete picture of the relationship between BMI and income by taking gender into consideration.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(nids1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(bmi_valid <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>hh.pcinc <span class="op">&lt;</span><span class="st"> </span><span class="dv">13000</span> <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span><span class="kw">is.na</span>(gender)), <span class="kw">aes</span>(hh.pcinc, bmi, <span class="dt">color =</span> gender)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">size=</span><span class="dv">1</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">se =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Comparing BMI and income (by gender)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">ylab</span>(<span class="st">&quot;BMI&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><img src="06-bivariate_analysis_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<p>Does this reflect the expected gender differences in BMI? What exactly is this graph telling us?</p>
<p>The graph shows that the relationship between BMI and income is positive for both men and women. The trend line for men is, however, steeper than the trend line for females. This suggests that an increase in income is associated with a greater increase in BMI for men than for women. In fact, BMI is fairly constant across all income levels for females.</p>
<p>From the graph it appears that at low income levels, women tend to have a substantially higher BMI than men. However, at incomes of R10000 the male and female trend lines cross. Let’s investigate this further.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids1<span class="op">$</span>inc.cat&lt;-<span class="ot">NA</span>
nids1<span class="op">$</span>inc.cat[<span class="kw">which</span>(nids1<span class="op">$</span>hh.pcinc<span class="op">&lt;</span><span class="dv">2500</span>)]&lt;-<span class="dv">1</span>
nids1<span class="op">$</span>inc.cat[<span class="kw">which</span>(nids1<span class="op">$</span>hh.pcinc<span class="op">&gt;=</span><span class="dv">2500</span> <span class="op">&amp;</span><span class="st"> </span>nids1<span class="op">$</span>hh.pcinc<span class="op">&lt;</span><span class="dv">5000</span>)]&lt;-<span class="dv">2</span>
nids1<span class="op">$</span>inc.cat[<span class="kw">which</span>(nids1<span class="op">$</span>hh.pcinc<span class="op">&gt;=</span><span class="dv">5000</span> <span class="op">&amp;</span><span class="st"> </span>nids1<span class="op">$</span>hh.pcinc<span class="op">&lt;</span><span class="dv">10000</span>)]&lt;-<span class="dv">3</span>
nids1<span class="op">$</span>inc.cat[<span class="kw">which</span>(nids1<span class="op">$</span>hh.pcinc<span class="op">&gt;=</span><span class="dv">10000</span> <span class="op">&amp;</span><span class="st"> </span>nids1<span class="op">$</span>hh.pcinc <span class="op">&lt;=</span><span class="kw">max</span>(nids1<span class="op">$</span>hh.pcinc))]&lt;-<span class="dv">4</span>
 
nids1<span class="op">$</span>inc.cat&lt;-<span class="kw">factor</span>(nids1<span class="op">$</span>inc.cat,
                       <span class="dt">levels =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>,
                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;&lt;2500&quot;</span>, <span class="st">&quot;250-4999&quot;</span>, <span class="st">&quot;5000-9999&quot;</span>, <span class="st">&quot;10000+&quot;</span>))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nids1<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">group_by</span>(inc.cat, gender)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">mbmi =</span> <span class="kw">mean</span>(bmi, <span class="dt">na.rm=</span>T)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">arrange</span>(gender,inc.cat)</code></pre></div>
<pre><code>## # A tibble: 8 x 3
## # Groups:   inc.cat [4]
##   inc.cat   gender  mbmi
##   &lt;fct&gt;     &lt;fct&gt;  &lt;dbl&gt;
## 1 &lt;2500     Male    23.3
## 2 250-4999  Male    25.9
## 3 5000-9999 Male    28.6
## 4 10000+    Male    27.5
## 5 &lt;2500     Female  28.9
## 6 250-4999  Female  30.1
## 7 5000-9999 Female  28.9
## 8 10000+    Female  29.2</code></pre>
<p>The table shows that the relationship between BMI and income is non-linear for females; BMI first increases with income and thereafter decreases. For males the trend is far more linear with only a marginal decline in BMI at very high income levels.</p>
<p><strong>8. What are some of the reasons why the relationship would be non-linear?</strong></p>
<p>Question 8 Answer</p>
<p>Let’s add a non-linear trend line to our BMI-income graph and see whether it picks up the non-linear trend apparent in the table. We restrict our sample to females only.</p>
<p>In this case, we want to fit a generalised additive model that fit splines from the <code>mgcv</code> package <span class="citation">(Wood <a href="#ref-R-mgcv">2018</a>)</span>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(mgcv)
nids1<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(bmi_valid <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>hh.pcinc <span class="op">&lt;</span><span class="st"> </span><span class="dv">13000</span> <span class="op">&amp;</span><span class="st"> </span>gender<span class="op">==</span><span class="st">&quot;Female&quot;</span>)<span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">ggplot</span>(., <span class="kw">aes</span>(<span class="dt">x =</span> hh.pcinc, <span class="dt">y =</span> bmi)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>x, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="kw">aes</span>(<span class="dt">colour =</span> <span class="st">&quot;linear&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">stat_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;gam&quot;</span>, <span class="dt">formula=</span> y <span class="op">~</span><span class="st"> </span><span class="kw">s</span>(x, <span class="dt">k =</span> <span class="dv">3</span>), <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">se =</span> <span class="ot">FALSE</span>, <span class="dt">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="kw">aes</span>(<span class="dt">colour =</span> <span class="st">&quot;polynomial&quot;</span>)) <span class="op">+</span>
<span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Comparing BMI and income(for women)&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">theme_classic</span>()</code></pre></div>
<p><img src="06-bivariate_analysis_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
<p>The curved non-linear trend supports the findings from our table; female BMI initially increases with income up until an income level of approximately R 5000 per month and thereafter it declines.</p>
<p>So far we have investigated the relationships between several variables using graphical and simple descriptive statistical methods. In the next chapter, we will be introduced to using simple regression analysis in R which will allow us to conduct far more powerful analyses. But before moving on, use the exercises to revise what you have learnt.</p>
</div>
<div id="question-answers-4" class="section level2">
<h2><span class="header-section-number">6.11</span> Question Answers</h2>
</div>
<div id="exercises-4" class="section level2">
<h2><span class="header-section-number">6.12</span> Exercises</h2>
<p><strong>1. Which of the following two variables is more closely related to total monthly income - show graphically and statistically? Variables: Metropolitan area, number of biological children who cried but later died?</strong></p>
<p>Exercise 1 Answer</p>
<p><strong>2. Create a table and a pie graph showing occupation categories for the males in the survey.</strong></p>
<p>Exercise 2 Answer</p>
<p><strong>3. Compare the number of hours worked per day and racial status. First, generate a table without missing values, then generate one with missing values.</strong></p>
<p>Exercise 3 Answer</p>
<p><strong>4. What is the total number of African households for whom the number of children residing in the house is greater than four?</strong></p>
<p>Exercise 4 Answer</p>
<p><strong>5. Recall that we created an age group variable, age_bins, in an earlier chapter. Using this variable or otherwise answer the following questions:</strong></p>
<ol style="list-style-type: lower-alpha">
<li>How many overweight 30-40 year olds in the sample?</li>
<li>b.What percentage of 50-60 year olds are underweight?</li>
<li>What percentage of obese people are between 30 and 40 years old? How many obese people are there in the sample in total?</li>
</ol>
<p>Exercise 5 Answer</p>
<p><strong>6.</strong><br />
a. Create a table that contains the mean BMI values for every age and gender group. Comment on the differences between the cells. b. Create a variable that assigns the mean BMI for the age-gender group into which the individual falls. For example, if the individual is a 54 year old female then she will be assigned the mean BMI of 50-60 year old females. Discuss how the results you obtain here relate to your answer to question 5.2.a.</p>
<p>Exercise 6 Answer</p>
</div>
<div id="exercise-answers-3" class="section level2">
<h2><span class="header-section-number">6.13</span> Exercise answers</h2>
</div>
<div id="session-information-4" class="section level2">
<h2><span class="header-section-number">6.14</span> Session information</h2>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(<span class="kw">sessionInfo</span>(), <span class="dt">locale =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## R version 3.5.1 (2018-07-02)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 7 x64 (build 7601) Service Pack 1
## 
## Matrix products: default
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] mgcv_1.8-24     nlme_3.1-137    gmodels_2.18.1  bindrcpp_0.2.2 
##  [5] forcats_0.3.0   stringr_1.3.1   dplyr_0.7.6     purrr_0.2.5    
##  [9] readr_1.1.1     tidyr_0.8.1     tibble_1.4.2    ggplot2_3.0.0  
## [13] tidyverse_1.2.1 foreign_0.8-70 
## 
## loaded via a namespace (and not attached):
##  [1] gtools_3.8.1     tidyselect_0.2.4 xfun_0.3         haven_1.1.2     
##  [5] lattice_0.20-35  colorspace_1.3-2 htmltools_0.3.6  yaml_2.2.0      
##  [9] utf8_1.1.4       rlang_0.2.1      pillar_1.3.0     glue_1.3.0      
## [13] withr_2.1.2      modelr_0.1.2     readxl_1.1.0     bindr_0.1.1     
## [17] plyr_1.8.4       munsell_0.5.0    gtable_0.2.0     cellranger_1.1.0
## [21] rvest_0.3.2      evaluate_0.11    labeling_0.3     knitr_1.20      
## [25] fansi_0.3.0      highr_0.7        broom_0.5.0      Rcpp_0.12.18    
## [29] scales_1.0.0     backports_1.1.2  gdata_2.18.0     jsonlite_1.5    
## [33] png_0.1-7        hms_0.4.2        digest_0.6.15    stringi_1.1.7   
## [37] bookdown_0.7     grid_3.5.1       rprojroot_1.3-2  cli_1.0.0       
## [41] tools_3.5.1      magrittr_1.5     lazyeval_0.2.1   crayon_1.3.4    
## [45] pkgconfig_2.0.2  Matrix_1.2-14    MASS_7.3-50      xml2_1.2.0      
## [49] lubridate_1.7.4  assertthat_0.2.0 rmarkdown_1.10   httr_1.3.1      
## [53] rstudioapi_0.7   R6_2.2.2         compiler_3.5.1</code></pre>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-R-memisc">
<p>Elff, Martin. 2017. <em>Memisc: Management of Survey Data and Presentation of Analysis Results</em>. <a href="https://CRAN.R-project.org/package=memisc" class="uri">https://CRAN.R-project.org/package=memisc</a>.</p>
</div>
<div id="ref-R-descr">
<p>Dirk Enzmann, Jakson Aquino. Includes R source code and/or documentation written by, Marc Schwartz, Nitin Jain, and Stefan Kraft. 2018. <em>Descr: Descriptive Statistics</em>. <a href="https://CRAN.R-project.org/package=descr" class="uri">https://CRAN.R-project.org/package=descr</a>.</p>
</div>
<div id="ref-R-gmodels">
<p>Bolker, Gregory R. Warnes andBen, Thomas Lumley, Randall C Johnson, and Randall C. Johnson. 2018. <em>Gmodels: Various R Programming Tools for Model Fitting</em>. <a href="https://CRAN.R-project.org/package=gmodels" class="uri">https://CRAN.R-project.org/package=gmodels</a>.</p>
</div>
<div id="ref-R-dplyr">
<p>Wickham, Hadley, Romain François, Lionel Henry, and Kirill Müller. 2018. <em>Dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
</div>
<div id="ref-R-mgcv">
<p>Wood, Simon. 2018. <em>Mgcv: Mixed Gam Computation Vehicle with Automatic Smoothness Estimation</em>. <a href="https://CRAN.R-project.org/package=mgcv" class="uri">https://CRAN.R-project.org/package=mgcv</a>.</p>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="measures-of-central-tendency-and-variability.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="simple-regression-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
